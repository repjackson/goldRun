template(name='building_layout')
    +nav
    with current_doc
        .ui.stackable.padded.grid
            .middle.aligned.row
                .four.wide.center.aligned.column
                    a.ui.circular.basic.button(href="/m/building")
                        i.left.chevron.icon
                        +i name='building' classes='ui mini inline image'
                        |buildings
                .eight.wide.center.aligned.column 
                    .ui.center.aligned.header 
                        |building #{title}
                .four.wide.center.aligned.column 
                    if can_edit
                        a.ui.circular.basic.icon.button(href="/building/#{_id}/edit")
                            i.setting.large.icon
            .row
                .sixteen.wide.column
                    a.ui.basic.circular.compact.button(href="/building/#{_id}/view" class="{{isActiveRoute regex='building_dashboard'}}")
                        +i name='dashboard' classes='ui avatar image'
                        |dashboard
                    a.ui.basic.circular.compact.button(href="/building/#{_id}/members" class="{{isActiveRoute regex='building_members'}}")
                        +i name='groups' classes='ui avatar image'
                        |members
                    a.ui.basic.circular.compact.button(href="/building/#{_id}/credit" class="{{isActiveRoute regex='building_credit'}}")
                        +i name='coins' classes='ui avatar image'
                        |credit
                    //- a.ui.basic.circular.compact.button(href="/building/#{_id}/meals" class="{{isActiveRoute regex='building_meals'}}")
                    //-     +i name='meal' classes='ui avatar image'
                    //-     |meals
                    //- a.ui.basic.circular.compact.button(href="/building/#{_id}/dishes" class="{{isActiveRoute regex='building_dishes'}}")
                    //-     +i name='meal' classes='ui avatar image'
                    //-     |dishes
                    a.ui.basic.circular.compact.button(href="/building/#{_id}/events" class="{{isActiveRoute regex='building_events'}}")
                        +i name='calendar' classes='ui avatar image'
                        |events
                    a.ui.basic.circular.compact.button(href="/building/#{_id}/food" class="{{isActiveRoute regex='building_food'}}")
                        +i name='food' classes='ui avatar image'
                        |food
                    a.ui.basic.circular.compact.button(href="/building/#{_id}/market" class="{{isActiveRoute regex='building_market'}}")
                        +i name='shop' classes='ui avatar image'
                        |market
                    //- a.ui.basic.circular.compact.button(href="/building/#{_id}/products" class="{{isActiveRoute regex='building_products'}}")
                    //-     +i name='shopping-cart' classes='ui avatar image'
                    //-     |products
                    //- a.ui.basic.circular.compact.button(href="/building/#{_id}/services" class="{{isActiveRoute regex='building_services'}}")
                    //-     +i name='service-bell' classes='ui avatar image'
                    //-     |services

            .row
                .four.wide.column 
                    +image_view key='image_id' icon='image' label='image'
                    //- +viewing
                .twelve.wide.column
                    +yield
    //- +footer

template(name='building_dashboard')
    .ui.grid
        .three.column.row
            .column
                .ui.inline.header 
                    +i name='shield'
                    |building leader: 
                a.ui.basic.button(href="/user/#{username}/")
                    |#{leader}
                .ui.header 
                    +i name='groups'
                    |#{members.count} members
                .ui.large.selection.animated.list
                    each members 
                        a.item(href="/building/#{_id}/#{username}")
                            img.ui.mini.image(src="{{c.url profile_image_id width=200 height=200}}")
                            .content
                                .header
                                    |#{username}
            .column
                .ui.header #{meal_count} total meals
                each building_meals
                    .ui.small.header #{dish.title}
                .ui.header #{upcoming_meal_count} upcoming meals
                each upcoming_building_meals
                    .ui.small.header #{dish.title}
                .ui.segment
                    .ui.header #{dish_count} dishes
                    .ui.selection.animated.list
                        each building_dishes
                            a.item(href="/dish/#{_id}/view")
                                img.ui.mini.circular.image(src="{{c.url image_id width=100 height=100}}")
                                .content
                                    .header 
                                        |#{title}
            .column
                //- +doc_array_toggle key='member_ids' value=currentUser._id add_label='join' remove_label='joined'
                .ui.header 
                    +i name='rss'
                    |activity
                each log_items
                    +log_item
                .ui.header 
                    +i name='line-chart'
                    |stats
                i.refresh.link.icon.refresh_building_stats
                .ui.large.list
                    .item #{member_count} members
                    .item #{meal_count} meals
                    .item #{dish_count} dishes
                    .item #{total_credit_exchanged} credits exchanged
                //- +comments
