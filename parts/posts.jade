template(name='posts')
    // +map2
    .ui.stackable.padded.grid
        .three.wide.column
            // .ui.inline.header 
            //     +i name='shop'
            //     |#{counter}
            //     |items for rent
            // div
            // .spacer
            .ui.icon.fluid.input
                i.search.icon
                input.query(type='text' placeholder='search...')
            .ui.inline.small.header
                i.marker.icon 
                |location tags
            each picked_location_tags
                button.ui.blue.compact.small.button.unpick_location_tag(tabindex='0')
                    //- i.remove.icon
                    | #{this}
            each location_tags
                button.ui.compact.small.button.pick_location_tag(tabindex="0" class=result_class title=count) #{title}
                    //- small #{count}
            div
            |sort by
            +set_sort_key key='views' label='views' icon='eye'
            // +set_sort_key key='datetime_available' label='available' icon='clock'
            +set_sort_key key='price' label='price' icon='money'
            +set_sort_key key='_timestamp' label='added' icon='clock'
            +set_sort_key key='comment_count' label='comment count' icon='chat'
            +set_sort_direction
            |&nbsp;
            |&nbsp;
            +limit_menu
        .thirteen.wide.column
            .sorting_row
                if selected_tag_plural
                    .ui.icon.black.compact.button.clear_picked_tags
                        i.remove.icon
                each picked_tags
                    button.ui.blue.compact.large.button.unselect_tag(tabindex='0')
                        //- i.remove.icon
                        | #{this}
                each tags
                    button.ui.compact.button.tag_result(tabindex="0" class=result_class title=count) #{title}
                        //- small #{count}
            .spacer 
            if subs_ready     
                .ui.stackable.four.centered.cards.scrolling
                    each post_docs
                        +post_card
                    unless post_docs.count
                        .ui.button.request_post
                            |request
                        each requests
                            .ui.header #{when}
            else 
                .ui.center.aligned.basic.segment
                    i.massive.grey.notched.circle.loading.icon
    .ui.stackable.padded.grid
        .four.wide.column
            .ui.inline.header 
                +i name='shop'
                |posts
            if currentUser
                a.ui.icon.basic.circular.button.add_post(title='cook')
                    i.plus.green.large.icon
            .div
            .ui.left.icon.search.small.input
                i.search.icon.refresh_tags
                input#search_tag.prompt(type='text' autocomplete="off" placeholder='tags')
            if selected_tag_plural
                .ui.icon.circular.black.compact.button.clear_picked_tags
                    i.remove.icon
            each picked_tags
                button.ui.blue.compact.circular.small.button.unselect_tag(tabindex='0')
                    //- i.remove.icon
                    | #{this}
            each tags
                button.ui.circular.compact.small.basic.button.tag_result(tabindex="0" class=result_class title=count) #{title}
                    //- small #{count}
            .spacer
        .twelve.wide.column
            //- .sorting_row
            //-     .ui.icon.input
            //-         i.search.icon
            //-         input.tag_search(type='text' placeholder='search...')
            //-     |sort by
            //-     .ui.compact.small.menu
            //-         .ui.simple.dropdown.item
            //-             strong #{current_post_sort_label}
            //-             i.dropdown.icon
            //-             .menu
            //-                 +set_post_sort_key key='price_per_serving' label='$/serving' icon='money'
            //-                 +set_post_sort_key key='datetime_available' label='available' icon='clock'
            //-                 //- +set_post_sort_key key='_timestamp' label='added' icon='clock'
            //-                 +set_post_sort_key key='comment_count' label='comment count' icon='chat'
            //-     .ui.compact.icon.circular.button.set_sort_direction(title='toggle sort direction')
            //-         if sorting_up
            //-             i.sort.amount.down.icon
            //-         else
            //-             i.sort.amount.up.icon
            //-     |&nbsp;
            //-     |&nbsp;
            //-     //- .ui.inline.small.grey.header
            //-     //-     |show
            //-     //- .ui.compact.menu
            //-     //-     .ui.simple.dropdown.item
            //-     //-         strong #{post_limit}
            //-     //-         i.dropdown.icon
            //-     //-         .menu
            //-     //-             +set_post_limit amount=1
            //-     //-             +set_post_limit amount=5
            //-     //-             +set_post_limit amount=10
            //-     //-             +set_post_limit amount=20
            //- .spacer 
            .ui.stackable.four.cards
                each post
                    +post_card


template(name='post_card')
    .ui.card(class=post_card_class)
        a.image.fly_right(href="/post/#{_id}/") 
            img.ui.zoomer.pointer.goto_post.image(src="{{c.url image_id width=400 height=300 crop='pad'}}")
        .content
            a.ui.inline.header.zoomer.fly_right(href="/post/#{_id}/") 
                | #{title}
            .ui.inline.header #{daily_rate}p/day
            // if tags
            //     i.tag.icon
            // each tags
            //     a.ui.small.link.black.label.flat_pick_tag.spaced #{this}
            .right.floated.meta
                | #{when}
            unless anonymous
                a(href="/user/#{_author_username}")
                    img.ui.avatar.image(src="{{c.url _author.image_id width=400 height=600 crop='fit'}}")
                    |#{_author_username}
            // .ui.label #{inventory} units available
            // .ui.label #{order_total} total orders
            if delivery
                +i name='deliver-post' cl='ui avatar image'
                if delivery_fee
                    .ui.inline.header(title='delivery fee') $#{delivery_fee}
            if open
                +i name='checkmark' cl='ui avatar image'
            else 
                i.ban.icon(title='not open to new orders')
            if pickup
                +i name='doormat' cl='ui avatar image'
            // if can_edit
            //     a.ui.large.icon.button(href="/post/#{_id}/edit")
            //         i.pencil.icon
            // if currentUser 
            //     i.thumbs.up.link.grey.icon.upvote
            // //     i.thumbs.down.link.grey.icon.downvote
            // if location_tags
            //     i.marker.icon.invert
            //     each location_tags  
            //         .ui.black.label #{this}
        //- .ui.bottom.attached.buttons        
        //-     .ui.green.button.quickbuy
        //-         i.lightning.icon
        //-         |buy
        //-     a.ui.button(href="/post/#{_id}/")
        //-         |view
        //-         i.right.chevron.icon







template(name='set_post_sort_key')
    .item.set_sort
        if color
            .ui.label(class=color) #{label}
        else 
            if emoji
                em(data-emoji=emoji)
            else if icon
                i.icon(class=icon)
            |#{label}
        

template(name='set_view_mode_post')
    .item.set_view
        i.icon(class=icon)
        |#{title}


template(name='set_post_limit')
    .item.set_limit #{amount}
    
    
// template(name='user_posts')
//     .scrolling
//         if is_current_user
//             .ui.circular.button.add_post
//                 i.plus.icon
//                 |post
//         each posts
//             +profile_post_item

// template(name='profile_post_item')
//     .ui.segment.grid
//         .row
//             .four.wide.column
//                 +image_view key='image_id' direct=true cl='zoom ui tiny image'
//             .twelve.wide.column
//                 .ui.header #{title}
//                 a.ui.small.header(href="/post/#{_id}/")
//                     |#{hourly_rate}c / hr
//                 a.ui.small.header(href="/post/#{_id}/")
//                     |#{daily_rate}c / day
//                 .ui.small.inline.header #{when}
//                 a.ui.button(href="/post/#{_id}/")
//                     |view
//                     i.right.chevron.icon
//                 if is_admin
//                     +remove_button
    
