template(name='tasks')
    .ui.stackable.padded.grid
        .four.wide.column
            .ui.inline.header 
                +i name='tasks'
                |#{task_docs.count}
                |tasks
            if currentUser
                a.ui.icon.circular.button.add_task(title='add task')
                    i.plus.green.large.icon
            // .ui.left.icon.search.small.input
            //     i.search.icon.refresh_tags
            //     input#search_tag.prompt(type='text' autocomplete="off" placeholder='tags')
            if selected_tag_plural
                .ui.icon.circular.black.compact.button.clear_picked_tags
                    i.remove.icon
            each picked_tags
                button.ui.blue.compact.circular.small.button.unselect_tag(tabindex='0')
                    //- i.remove.icon
                    | #{this}
            each tags
                button.ui.circular.compact.small.button.tag_result(tabindex="0" class=result_class title=count) #{title}
                    //- small #{count}
            .spacer
            
        .twelve.wide.column
            .sorting_row
                +session_boolean_toggle key='view_my_tasks' label='my tasks' icon='user-male'
                +session_boolean_toggle key='view_complete_tasks' label='complete' icon='checkmark'
                +session_boolean_toggle key='view_my_assignments' label='my assignments' icon='user-folder'
                .ui.icon.input
                    i.search.icon
                    input.tag_search(type='text' placeholder='title..')
                small sort
                .ui.compact.small.menu
                    .ui.simple.dropdown.item
                        if sort_icon
                            +i name=sort_icon cl='ui avatar image'
                        strong #{sort_label}
                        i.dropdown.icon
                        .menu
                            +set_sort_key key='complete' label='complete' icon='checkmark'
                            // +set_sort_key key='datetime_available' label='available' icon='clock'
                            +set_sort_key key='_timestamp' label='added' icon='clock'
                            // +set_sort_key key='comment_count' label='comment count' icon='chat'
                            +set_sort_key key='_author_username' label='author' icon='user-male'
                +set_sort_direction
                |&nbsp;
                |&nbsp;
                .ui.inline.small.grey.header
                    |show
                .ui.compact.menu
                    .ui.simple.dropdown.item
                        strong #{current_limit}
                        i.dropdown.icon
                        .menu
                            +set_limit amount=1
                            +set_limit amount=5
                            +set_limit amount=10
                            +set_limit amount=20
            .spacer 
            .ui.stackable.four.cards.scrolling
                each task_docs
                    +task_card


template(name='task_card')
    .ui.card(class=task_card_class)
        .image
            img.ui.zoom.pointer.goto_task.image(src="{{c.url image_id width=400 height=300 crop='pad'}}")
        .content
            a.ui.header(href="/task/#{_id}/") 
                | #{title}
            each tags
                .ui.small.circular.label #{this}
        .content
            .right.floated.meta
                | {{from_now _timestamp}}
            //- if session_is 'view_users' true
            a(href="/user/#{_author_username}")
                img.ui.avatar.image(src="{{c.url author.image_id width=400 height=600 crop='fit'}}")
                |#{_author_username}
            if target_user_id
                |assigned to
                with target_user_id
                    +user_info
            if due_datetime
                i.clock.grey.icon
                |due {{short_date due_datetime}}
        if description
            .content    
                |!{description}
        .content    
            if complete 
                i.big.circular.green.checkmark.icon
            if can_edit
                a.ui.large.icon.button(href="/task/#{_id}/edit")
                    i.pencil.icon
            a.ui.icon.button(href="/task/#{_id}/")
                i.chevron.right.icon


template(name='task_view')
    with current_doc
        .ui.stackable.padded.grid
            .row
                .six.wide.column 
                    a.ui.circular.icon.button(href="/tasks")
                        i.left.chevron.icon
                        +i name='tasks' cl='ui inline avatar image'
                        // |tasks
                    .ui.inline.grey.header viewing task
                    if can_edit
                        a.ui.big.icon.circular.button(href="/task/#{_id}/edit")
                            i.pencil.large.icon
                    +image_view key='image_id' label='image' direct=true
                    +voting_full
                    +viewing
                    if published 
                        .ui.small.header 
                            i.eye.icon
                            |published on {{long_date publish_timestamp}}
                .ten.wide.column
                    .ui.header #{title} 
                    if has_description
                        +html_view key='description' label='content' icon='content' direct=true
                    +boolean_view key='has_bounty' label='has bounty' icon='coins' direct=true
                    if has_bounty
                        +number_view key='bounty_amount' label='bounty amount' icon='coins' direct=true
                .four.wide.column 
                    +boolean_view key='has_due_date' label='has due date' icon='clock' direct=true
                    if has_due_date
                       +datetime_view key='due_datetime' label='due date/time' icon='clock' direct=true
                    +boolean_view key='has_target_user' label='has target user' icon='clock' direct=true
                    if has_target_user
                        +single_user_view key='target_user_id' label='target user' direct=true
                    +html_view key='description' icon='content' label='description' direct=true
                    if location_tags
                        +array_view key='location_tags' label='location tags' icon='marker' direct=true
                    +array_view key='tags' label='tags' icon='tags' direct=true
                    div
                    +comments


template(name='task_edit')
    with current_doc
        .ui.stackable.padded.grid
            .row
                .four.wide.column
                    .ui.header 
                        |editing task
                    if published 
                        a.ui.fluid.icon.green.button(href="/task/#{_id}/" title='save')
                            i.checkmark.big.icon
                    else 
                        a.ui.fluid.icon.green.button.publish(href="/task/#{_id}/" title='save')
                            i.checkmark.big.icon
                            |save & publish
                    +remove_button
                    +image_edit key='image' label='image' direct=true
                    +array_edit key='tags' label='tags' icon='tags' direct=true
                    +array_edit key='location_tags' label='location tags' icon='marker' direct=true
                                        
                .eight.wide.column 
                    +text_edit key='title' direct=true
                    +boolean_edit key='has_description' label='has description' icon='content' direct=true
                    if has_description
                        +html_edit key='description' label='content' icon='content' direct=true
                    +boolean_edit key='has_bounty' label='has bounty' icon='coins' direct=true
                        
                .four.wide.column 
                    if has_bounty
                        +number_edit key='bounty_amount' label='bounty amount' icon='coins' direct=true
                    +boolean_edit key='has_target_user' label='has target user' icon='clock' direct=true
                    if has_target_user
                        +single_user_edit key='target_user_id' label='target user' direct=true
                    +boolean_edit key='has_due_date' label='has due date' icon='clock' direct=true
                    if has_due_date
                       +datetime_edit key='due_datetime' label='due date/time' icon='clock' direct=true
