template(name='post_card')
    a.ui.link.card.fly_right(href="/doc/#{_id}")
        if youtube_id
            +youtube_view key='youtube_id'
        else if image_id
            img.ui.fluid.rounded.image(src="{{c.url image_id height=200 width=400 gravity='face' crop='fill'}}" class=currentUser.invert_class)
        .content
            a.ui.large_text.zoomer(href="/doc/#{_id}" class=emotion_color) #{title}
            if private 
                i.large.lock.icon
            .ui.small.grey.inline.header #{when}
            .smallcut
                | !{content}
            if views
                |#{views} views
            +author_info
            if group_id     
                +group_info
template(name='post_card_med')
    a.ui.link.card.fly_right(href="/doc/#{_id}")
        if youtube_id
            +youtube_view key='youtube_id'
        else if image_id
            img.ui.fluid.rounded.image(src="{{c.url image_id height=200 width=400 gravity='face' crop='fill'}}" class=currentUser.invert_class)
        .content
            a.ui.large_text.zoomer(href="/doc/#{_id}" class=emotion_color) #{title}
            if private 
                i.large.lock.icon
            .ui.small.grey.inline.header #{when}
            .smallscroll
                | !{content}
            if views
                .ui.basic.label(title='views')
                    i.grey.eye.icon
                    |#{views}
            +author_info
            if group_id     
                +group_info
template(name='post_item')
        

template(name='post_view')
    .ui.stackable.padded.grid
        .row 
            .sixteen.wide.column.scrollin
                .ui.big.center.aligned.inline.header(class=emotion_color) 
                    if price
                        i.large.coins.icon(title='price')
                    if private 
                        i.large.lock.icon(title='private')
                    if sentiment 
                        if is sentiment 'positive'
                            +i name='happy'
                        else 
                            +i name='sad'
                if subtitle
                    .ui.small.header #{subtitle}
                // a.ui.header(href="/user/#{target.username}")
                //     |#{target.username}
                if youtube_id
                    +youtube_view key='youtube_id'
                
                
template(name='post_orders')
    .ui.segment 
        .ui.header 
            |post price: #{price}
        if has_access 
            with access_doc 
                .ui.header purchased access #{when}
        else 
            .ui.button.purchase_access
                |purchase access
                
                
                

template(name='visibility_settings')
    .ui.dividing.header 
        +i name='eye'
        |visibility settings
    if private 
        .ui.header 
            i.lock.icon
            |private
    if friends_only
        .ui.header 
            +i name='friends'
            |friends only
    +key_value_edit key='visibility' value='published' icon='checkmark' classes='green'
    +key_value_edit key='visibility' value='private' icon='lock' classes='blue'
    +key_value_edit key='visibility' value='draft' icon='checkmark' classes='orange'


template(name='post_edit')
    .ui.stackable.padded.grid
        .row 
            .eight.wide.column
                .ui.inline.header 
                    +i name='cube'
                    |sections
                +boolean_edit key='has_subtitle' label='subtitle (-1p)' icon='header'
                if has_subtitle
                    +text_edit key='subtitle' label='subtitle' direct=true icon='header'
                +boolean_edit key='has_price' label='price' icon='coins'
                if has_price
                    .ui.segment 
                        .ui.header 
                            |premium settings 
                        +number_edit key='price' label='price (points)' icon='money'
            .eight.wide.column
                .ui.inline.header 
                    +i name='happy'
                    |sentiment
                +key_value_edit key='sentiment' value='positive' label='positive' icon='happy'
                +key_value_edit key='sentiment' value='negative' label='negative' icon='sad'
                // +boolean_edit key='published' icon='visible' direct=true
                    
                    
template(name='product_card')
    if rescued 
        .ui.top.right.attached.blue.label(title='rescued')
            i.search.icon
    if local 
        .ui.top.right.attached.corner.green.label(title='local')
            i.marker.icon
    // a.zoomer.fly_right(href="/doc/#{_id}") 
    //     img.ui.centered.image(src="{{c.url image_id width=400 height=300 crop='pad'}}")
    // .content
        // a.ui.header.fly_right(href="/doc/#{_id}") 
        //     //- |#{_author.name}'s
        //     | #{title}
        //- if session_is 'view_ingredients' true
        //- .ui.inline.small.header tags
        // .content
        //     .right.floated.meta
        //         | {{from_now datetime_available}}
        //     //- if session_is 'view_users' true
        // //- a.image(href="/doc/#{_id}")
            
    .content    
        .ui.inline.header 
            |{{price_points}}pts
        i.big.link.cart.plus.green.icon.add_to_cart
                
                
template(name='product_item')
    img.ui.small.inline.image(src="{{c.url image_id width=400 height=300 crop='pad'}}")
    .ui.inline.header
        //- |#{_author.name}'s
        | #{title}



template(name='product_view')
    .ui.stackable.padded.grid
        .one.column.row
            .column
                +html_view key='description'
                // +text_view key='size_description' label='size description' 
                a.ui.circular.button(href=product_link)
                    // i.wordpress.large.icon
                    i.external.icon
                    |#{product_link}
                if is_food
                    +boolean_view key='gluten_free' label='gluten free' icon='no-gluten'
                    +boolean_view key='vegetarian' label='vegetarian' icon='vegetarian-mark'
                    +boolean_view key='no_sugar_added' label='no sugar added' icon='no-sugar2'
                    +boolean_view key='vegan' label='vegan' icon='vegan-symbol'
                    +boolean_view key='paleo' label='paleo' icon='caveman'
                    +boolean_view key='local' label='local' icon='marker'
                    +boolean_view key='nut_free' label='nut free' icon='no-peanut'
                    +boolean_view key='rescued' label='rescued' icon='nothing-found'
                    +boolean_view key='organic' label='organic' icon='organic-food'
                    +boolean_view key='no_gmo' label='no gmo' icon='no-gmo'
                    +boolean_view key='jar' label='jar container (requires deposit & return)' icon='mason-jar'
                    // .ui.header #{menu_section}
                            +link_edit key='amazon_referral_link' label='amazon referral link' icon='amazon'
                    // +boolean_view key='has_2cup' label='2 cup' icon='cup'
                    div
                    .ui.inline.header 
                        +i name='ingredients'
                        |ingredients
                    each ingredients
                        .ui.large.basic.label.goto_ingredient #{this}
                    div
                +link_view key='amazon_referral_link' label='amazon link' icon='amazon'
                +link_view key='external_link' label='external link' icon='globe'
                
                // +product_orders
            .column
                .ui.header #{price_points} points
                .ui.header $#{price_usd}
                .ui.big.fluid.green.button.add_to_cart
                    i.cart.plus.large.icon
                    |add to cart
                +bookmark_button
                // .ui.large.button.generate_qrcode
                //     i.large.qrcode.icon
                //     |generate qr code
                // #qrcode(width='400px')
                if is_managing_inventory
                    .ui.segment
                        +product_inventory
                .ui.list
                    a.item(href=product_link title=product_link target='_window') 
                        i.external.icon
                        |external link
                    .item calculated inventory
                    .item #{total_units_sold} total units sold
                    .item $#{total_revenue} total revenue
                    // .item expected inventory
                    // .item query params: #{query_params}
                i.refresh.large.link.icon.calc_stats(title='refresh_stats')
            .column
                +product_reviews
            .five.wide.column
                +product_subscriptions
                // .ui.green.large.button.add_to_cart
                //     // i.cart.plus.large.icon
                //     +i name='add-shopping-cart--v1' cl='ui avatar image'
                //     |add to cart
                // .ui.link.card.zoomer.goto_source
                //     img.ui.fluid.image(src="{{c.url product_source.image_id width=200 height=200 gravity='face' crop='fill'}}")
                //     .content
                //         .ui.header.zoomer
                //             |#{product_source.title}
                .ui.header 
                    i.fork.icon
                    |related products
                each related_products
                    a.ui.header(href="/doc/#{_id}") #{title}
                        
        
        
            
template(name='product_inventory')      
    .ui.inline.header 
        +i name='shield'
        |inventory
    div 
    .ui.list #{last_inventory_record} most recent record
    a.ui.icon.basic.button.add_inventory
        i.plus.icon
    .ui.large.selection.list
        each inventory_items
            .item
                .content
                    // unless editing_this
                    img.ui.rounded.small.inline.image(src="{{c.url image_id gravity='face' crop='fit'}}" class=cl)
                    
                    // +image_view key='image_id' cl='ui tiny inline image'
                    .ui.basic.label ##{amount}
                    .ui.basic.label #{location}
                    if notes
                        .ui.basic.label notes: #{notes}
                    .ui.basic.label
                        i.user.icon
                        |#{staff}
                    i.edit.link.icon.edit_inventory_item
                    if editing_this
                        +number_edit key='amount' label='amount'
                        +key_value_edit key='location' value='boh' label='boh'
                        +key_value_edit key='location' value='foh' label='foh'
                        // +text_edit key='location' label='location' icon='marker'
                        +text_edit key='notes' label='notes' icon='pencil'
                        // +text_edit key='staff' label='staff' icon='user'
                        +image_edit key='image_id'
                        // +key_value_edit key='staff' value='matt'
                        // +key_value_edit key='staff' value='nena'
                        // +key_value_edit key='staff' value='rachel'
                        // +key_value_edit key='staff' value='jimmy'
                        // +key_value_edit key='staff' value='elena'
                        // +key_value_edit key='staff' value='eric'
                        // +key_value_edit key='staff' value='luke'
                        // +key_value_edit key='staff' value='mateo'
                        i.checkmark.green.link.circular.large.icon.save_inventory_item

template(name='product_reviews')
    .ui.inline.header 
        +i name='popular-topic'
        |reviews
    .ui.circular.basic.icon.button.add_review
        i.plus.icon
    div
    each product_recipes
        a.ui.header(href="/recipe/#{_id}/view") #{title}
        
template(name='product_subscriptions')     
    div
    if subscribed
        .ui.basic.green.inverted.button.unsubscribe
            i.undo.icon
            |unsubscribe
    else
        .ui.basic.green.inverted.button.subscribe
            i.undo.icon
            |subscribe
    .ui.small.header 
        +i name='clock'
        |subs
    .ui.link.selection.animated.list
        each product_subs
            a.item(href="/sub/#{_id}") 
                |#{when} #{_author_username}
                .ui.basic.label #{sub_day}
                .ui.basic.label #{sub_frequency}
    .ui.small.header 
        |your subscriptions

template(name='product_orders')                            
    if can_order
        +order_button
    each subs
        .ui.header #{_author_username}
    .ui.header 
        +i name='order-history'
        |#{product_orders.count}
        |orders
        |(${{fixed product_order_total}})
    .ui.basic.segments
        each product_orders
            +product_order_card
    .ui.header #{views} views
    +order_status_icons
    .ui.hidden.divider
                
template(name='order_status_icons')  
    a.zoomer(href="/order/#{_id}")
        if runner_viewed
            +icolor name='eye-checked' cl='ui avatar image'
        if preparing
            +icolor name='new-product--v1' cl='ui avatar image'
        if prepared
            +icolor name='handle-with-care' cl='ui inline image'
        if arrived
            +icolor name='checked-truck' cl='ui inline image'
        if delivered
            +icolor name='checkmark' cl='ui inline image'
        
        if delivery_photo
            +image_view key='delivery_photo' direct=true cl='ui tiny inline image'

         
template(name='product_order_card')
    .ui.segment(class=product_order_class)
        .ui.inline.green.header
            |${{fixed order_price}} 
            if _author.image_id
                img.ui.avatar.image(src="{{c.url _author.image_id width=100 height=100 gravity='face' crop='fill'}}")
            |#{_author.username}
        // div
        .ui.large.basic.label
            i.clock.icon
            |status: #{status}
        .ui.small.inline.header
            | #{when} ({{long_date _timestamp}})
        a.ui.compact.big.icon.button(href="/order/#{_id}")
            i.right.chevron.large.icon
        if is_author
            .ui.small.compact.basic.button.cancel_order(title='cancel')
                i.remove.red.icon
                |cancel



template(name='order_button')
    // if servings_left
    .ui.green.large.button.order_product
        i.cart.plus.large.icon
        strong ${{fixed price_usd}}
        // |order #{serving_unit}
        // small order for
        // strong #{price_franc}f
    // else 
    //     .ui.grey.header sold out
        //- .ui.teal.large.button.join_waitlist
        //-     i.clock.large.icon
        //-     |join wait list




template(name='product_edit')
    .ui.stackable.padded.one.column.grid
        .row
            .column
                +image_edit key='image_id2' label='alt image' direct=true
                +link_edit key='link' label='external link' direct=true
                // div
            .column
                +float_edit key='price_usd' label='price' icon='us-dollar-circled'
                +number_edit key='price_points' label='point price' icon='coins'
                +text_edit key='size_description' label='size description' icon='content'
                .ui.inline.header food
                +boolean_edit key='is_food' label='is food' icon='food'
                if is_food
                    +boolean_edit key='gluten_free' label='gluten free' icon='no-gluten'
                    +boolean_edit key='paleo' label='paleo' icon='caveman'
                    +boolean_edit key='vegetarian' label='vegetarian' icon='vegetarian-mark'
                    +boolean_edit key='no_sugar_added' label='no sugar added' icon='no-sugar2'
                    +boolean_edit key='vegan' label='vegan' icon='vegan-symbol'
                    +boolean_edit key='no_gmo' label='no gmo' icon='no-gmo'
                    +boolean_edit key='local' label='local' icon='marker'
                    +boolean_edit key='nut_free' label='nut free' icon='no-peanut'
                    +boolean_edit key='rescued' label='rescued' icon='nothing-found'
                    +boolean_edit key='kosher' label='kosher' icon='judaism'
                    +boolean_edit key='organic' label='organic' icon='organic-food'
                    // +boolean_edit key='jar' label='jar container (requires deposit & return)' icon='mason-jar'
                    div
                    +number_edit key='calories' label='calories' icon='food'
                div
                +boolean_edit key='is_managing_inventory' label='manage inventory' icon='inventory'
                if is_managing_inventory
                    .ui.segment 
                        .ui.header 
                            +i name='inventory'
                            |inventory
                        +number_edit key='inventory_amount' label='inventory amount' icon='hashtag'
                +boolean_edit key='can_subscribe' label='can subscribe' icon='calendar'
                if can_subscribe
                    .ui.segment 
                        .ui.header 
                            +i name='inventory'
                            |subscription settings
                        +key_value_edit key='subscription_frequency' value='weekly' label='weekly'
                        +key_value_edit key='subscription_frequency' value='monthly' label='monthly'
                            
template(name='message_author_button')
    .ui.circular.large.button.message_author
        +i name='envelope'
        |message #{_author_username}



template(name='user_services')
    .ui.header 
        +i name='wrench'
        |user services
        .ui.list 
        each user_service_docs 
            .item #{title}
    .ui.header 
        +i name='shopping-cart'
        |purchases
    .ui.list 
        each service_purchas_docs 
            .item 
                |#{_parent.title} #{amount}
        
        

template(name='service_card')
    .ui.link.card.view_service.pointer.fly_right
        img.ui.fluid.rounded.image(src="{{c.url image_id height=200 width=400 gravity='face' crop='fill'}}" class=currentUser.invert_class)
        .content
            a.ui.header.zoomer(href="/service/#{_id}") #{title}
            if private 
                i.large.lock.icon
            .ui.small.grey.inline.header #{when}
            | !{content}
            +author_info
            if group_id     
                +group_info
            .ui.label 
                i.eye.icon
                |#{views}
            
        
template(name='service_item')
    .ui.fluid.segment.view_service.pointer
        a.ui.header(href="/service/#{_id}/view") #{title}
        div
        .ui.small.grey.inline.header #{when}
        | !{content}
        each tags 
            .ui.basic.small.label #{this}
        

template(name='service_view')
    .ui.stackable.padded.grid
        .row 
            .four.wide.column.scrolling
                .ui.inline.grey.header {{from_now start_datetime}}
                .ui.list
                    .item #{views} views
                each viewers
                    .ui.label #{username
                +array_view key='location_tags' label='location_tags' direct=true
            .twelve.wide.column.scrolling   
                .ui.green.button 
                    |purchase

template(name='service_edit')
    .ui.stackable.padded.grid
        .one.column.row 
            .column.scrollin
                +number_edit key='price' label='price (pts)' icon='coins'
                +array_edit key='location_tags' label='location tags' icon='marker' direct=true
                +audience_settings
                
                
                
                
template(name='event_card')
    .ui.zoomer.card
        .content
            a.ui.inline.header.fly_right(href="/doc/#{_id}") #{title} 
            div
            if is_in_past
                i.big.undo.icon 
                |in past
            if start_datetime
                .ui.small.inline.grey.header 
                    |{{medium_date start_datetime}} 
                    if time 
                        |{{time}}
                .ui.small.inline.header {{from_now start_datetime}}
            else if is_repeating
                +i name='refresh' title='repeating'
                |every #{repeating_day}
            // .ui.inline.small.header {{long_date start_datetime}}
            // div
            // .ui.small.grey.inline.header {{from_now start_datetime}}
        if image_id
            a.image.zoom.pointer.mobile.hidden.fly_right(href="/doc/#{_id}")
                img.ui.image(src="{{c.url image_id height=500 width=500 gravity='face' crop='fill'}}" class=currentUser.invert_class)
            a.image.zoom.pointer.mobile.only.fly_right(href="/doc/#{_id}")
                img.ui.image(src="{{c.url image_id height=200 width=500 gravity='center' crop='fill'}}" class=currentUser.invert_class)
        .content
            if tags 
                i.tag.icon
                each seven_tags 
                    .ui.link.label.zoomer.pick_flat_tag
                        |#{this}
            if location
                i.marker.icon 
                |#{location}
            div 
            // small led by
            img.ui.avatar.image(src="{{c.url host.image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
            // strong #{host.name}
            if views 
                span(title='views')
                    |#{views} 
                    i.eye.grey.icon
        .content
            |#{event_tickets.count}
            a(href="/doc/#{_id}" title='ticket purchase required')
                i.checkmark.green.link.icon
            | #{going_user_ids.count}
            each going
                img.ui.avatar.image(src="{{c.url image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
            i.question.orange.link.icon.mark_maybe(title='mark yourself maybe')
            div
            | #{maybe_user_ids.length}
            each maybe_going
                img.ui.avatar.image(src="{{c.url image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
            | #{not_user_ids.length}
            div
            i.ban.red.link.icon.mark_not(title='mark yourself not')
            each not_going
                img.ui.avatar.image(src="{{c.url image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
            if doc_comments.count
                .meta
                    each doc_comments 
                        i.grey.chat.outline.icon
                        img.ui.avatar.image(src="{{c.url _author.image_id height=200 width=200 gravity='face' crop='fill'}}" class=user_class)
                        |#{body}


template(name='event_item')
    .content
        if image_id
            a.fly_right(href="/doc/#{_id}")
                img.ui.small.inline.image.rounded(src="{{c.url image_id gravity='center' crop='fill'}}" class=currentUser.invert_class)
        a.ui.inline.header.fly_right(href="/doc/#{_id}") #{title} 
        .ui.small.inline.header {{medium_date date}} 
            if time 
                |{{time}}
        if start_datetime
            .ui.small.inline.grey.header 
                |{{medium_date start_datetime}} 
                if time 
                    |{{time}}
            .ui.small.inline.header {{from_now start_datetime}}
        if is_repeating
            +i name='refresh' title='repeating'
            |every #{repeating_day}
                
        // .ui.inline.small.header {{long_date start_datetime}}
        // div
        // .ui.small.grey.inline.header {{from_now start_datetime}}
        if location
            i.marker.icon 
            |#{location}
        // small led by
        img.ui.avatar.image(src="{{c.url host.image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
        strong #{host.name}
        |#{event_tickets.count}
        a(href="/doc/#{_id}" title='ticket purchase required')
            i.checkmark.green.link.icon
        | #{maybe_user_ids.count}
        each going
            img.ui.avatar.image(src="{{c.url image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
        i.question.orange.link.icon.mark_maybe(title='mark yourself maybe')
        | #{maybe_user_ids.length}
        each maybe_going
            img.ui.avatar.image(src="{{c.url image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
        | #{not_user_ids.length}
        i.ban.red.link.icon.mark_not(title='mark yourself not')
        each not_going
            img.ui.avatar.image(src="{{c.url image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
        if doc_comments.count
            .meta
                each doc_comments 
                    i.grey.chat.outline.icon
                    img.ui.avatar.image(src="{{c.url _author.image_id height=200 width=200 gravity='face' crop='fill'}}" class=user_class)
                    |#{body}
    


template(name='gcal_button')
    a.ui.circular.circular.large.button(href="http://www.google.com/calendar/event?action=TEMPLATE&text=#{title}&dates=#{start_datetime}/#{end_datetime}&details=#{description}&location=#{location}" target="_window")
        // i.calendar.icon
        +i name='external'
        |+ gcal
        
template(name='reserve_button')
    if slot_res
        .ui.segment
            with slot_res
                .ui.header 
                    |reserved by #{_author.name}
                if can_edit
                    .ui.circular.icon.button.cancel_res
                        i.red.remove.icon
    else 
        // if event_room.dollars_per_hour
        //     .ui.green.button.buy_slot buy slot #{slot}
        //     .ui.green.button.request_slot request for points
        // else
        .ui.green.button.reserve_slot reserve slot #{slot}
        
        
        
template(name='rsvp')
    div
    if is_in_past 
        .ui.header is in past
        
    if has_tickets
        .ui.header 
            i.green.ticket.icon
            |tickets
        if external_ticket_management
            .ui.header 
                |tickets handled externally, visit 
            a.ui.button(href=link target="_window")
                |#{link}
    .ui.inline.large.header 
        |RSVP
    if tickets_left
        .ui.grey.small.inline.header #{tickets_left} available
        .spacer
        .ui.grey.small.inline.header  min requested 
        // .spacer
        // .ui.grey.small.inline.header (give more if you want to)
        div
    if my_ticket
        .ui.header your ticket
        with my_ticket
            .ui.segment
                // if is_usd
                //     .ui.inline.green.header ${{money_format amount}}
                // else
                .ui.inline.header #{point_amount}pts
                |#{when} 
                if is_usd
                    .ui.button.request_refund
                        i.undo.icon
                        |request refund
                else
                    .ui.button.return
                        i.undo.icon
                        |return
    unless my_ticket
        if price_points
            .ui.green.button.buy_ticket
                |buy ticket #{price_points}p
    if event_ticket_docs.count
        .ui.dividing.header
            // +icolor name='activity-history' cl='ui inline image'
            |#{event_ticket_docs.count} spots reserved
    .ui.comments
        each event_ticket_docs
            .comment
                a.avatar(href="/user/#{_author.username}") 
                    img(src="{{c.url _author.image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                a.content(href="/ticket/#{_id}")
                    a.author(href="/user/#{_author.username}") 
                        |#{_author.name}
                    .metadata
                        span.date #{when}
                    .text
                        if is_usd
                            .ui.inline.green.header ${{money_format amount}}
                        else
                            .ui.inline.header #{point_amount}pts
                    // span.meta
                    //     if can_edit
                    //         +remove_icon
                    //     else
                    //         +voting_small
        
    +attendance
    // .ui.modal
    //     i.close.icon
    //     .header buy ticket for #{data_doc.point_price}pts?
    //     .content
    //         .description
    //             .ui.header event title: #{data_doc.title}
    //             .ui.input
    //                 input(type='number' min=data_doc.point_price)
    //     .actions
    //         .ui.red.cancel.button cancel
    //         .ui.green.big.ok.button ok


template(name='attendance')
    if is_in_past
        if event_tickets.length
            .ui.inline.green.header 
                |#{ticket.length} tickets bought
        .ui.disabled.button 
            .ui.green.header
                i.green.checkmark.big.icon
                |#{going.count}
                |went
    else
        if event_tickets.length
            .ui.inline.green.header 
                |#{ticket.length} going
        .ui.button.mark_going 
            .ui.green.header
                i.green.checkmark.big.icon
                |#{going.count}
                |going
    each going 
        a.ui.circular.circular.button(href="/user/#{username}")    
            img.ui.avatar.compact.image(src="{{c.url image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
            |#{username}
    div
    if is_in_past
        .ui.circular.disabled.button
            .ui.orange.header
                // if currentUser
                //     +icolor name='clock' cl='mark_maybe pointer'
                // else
                i.question.icon
                |#{maybe_going.count} said maybe
        // .ui.icon.button.mark_maybe 
        //     i.yellow.minus.big.icon
    else
        .ui.circular.button.mark_maybe
            .ui.orange.header
                // if currentUser
                //     +icolor name='clock' cl='mark_maybe pointer'
                // else
                i.question.icon
                |#{maybe_going.count} maybe
        // .ui.icon.button.mark_maybe 
        //     i.yellow.minus.big.icon
    each maybe_going
        a.ui.circular.button.fly_right(href="/user/#{username}")    
            img.ui.avatar.compact.image(src="{{c.url image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
            |#{username}
    div
    if is_in_past
        .ui.circular.disabled.button
            .ui.red.header
                i.ban.icon
                |#{not_going.count} didn't go
            // .ui.icon.button.pick_not
                // i.big.ban.icon
    else
        .ui.circular.button.mark_not
            .ui.red.header
                i.ban.icon
                |#{not_going.count} not going
            // .ui.icon.button.pick_not
                // i.big.ban.icon
    each not_going
        a.ui.circular.circular.button(href="/user/#{username}")    
            img.ui.avatar.compact.image(src="{{c.url image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
            |#{username}


template(name='ticket_view')
    with data_doc
        .ui.stackable.padded.grid
            .row 
                .four.wide.column
                    if can_edit
                        .ui.button.cancel_reservation
                            i.large.remove.icon
                            |cancel reservation
                .eight.wide.column
                    .ui.header
                        i.ticket.icon
                        |#{ticket_point_price}
                        | points ticket
                    .ui.small.header
                        i.clock.icon
                        | #{when}
                    .ui.segment
                        .ui.inline.header 
                            i.user.outline.icon
                            |buyer
                        a.ui.inline.header(href="/user/#{_author.username}") 
                            img.ui.avatar.image(src="{{c.url _author.image_id height=200 width=200 gravity='face' crop='fill'}}")
                            |#{_author.username}
                    .ui.segment
                        a.ui.inline.header(href="/doc/#{event_id}")
                            i.calendar.icon
                            |event
                        a(href="/doc/#{event_id}")
                            img.ui.medium.image(src="{{c.url ticket_event.image_id height=200 width=200 gravity='face' crop='fill'}}")
                        a.ui.header(href="/doc/#{ticket_event._id}")
                            |#{ticket_event.title}
                            
                    +number_view key='amount' label='amount' 
                    +textarea_view key='description' label='description' 
                    +image_view key='image_id' label='image' 
                    div 
                    if tags
                        i.tags.icon
                        each tags 
                            .ui.big.label #{this}
                    .spacer
                    .spacer
                    //- +array_view key='location_tags' label='location_tags' 
                .four.wide.column
                    //- .ui.fluid.green.button.submit
                    //-     i.checkmark.icon
                    //-     |submit



template(name='event_view')
    .ui.stackable.padded.grid
        .middle.aligned.row 
            .sixteen.wide.column
                if is_repeating
                    .ui.inline.grey.header
                        +i name='refresh'
                        |repeating on #{repeating_day} at 
                        |#{start_time}
                // div
                if can_edit
                    if published 
                        i.big.eye.green.icon(title='published')
                    else 
                        i.big.eye.red.slash.icon(title='unpublished')
                // div
                // .ui.inline.header {{medium_date date}}
                if start_datetime
                    .ui.inline.header {{long_date start_datetime}}
                    |&nbsp;
                    .ui.inline.grey.header {{from_now start_datetime}}
                
                if time 
                    .ui.inline.grey.header {{time}}
                if can_edit
                    a.edit_event.fly_left(href="/doc/#{_id}/edit" title='edit')
                        i.large.link.pencil.circular.icon
                if link 
                    a.ui.button(href=link target="_window")
                        i.globe.icon 
                        |#{link}
            .sixteen.wide.column
                // a.ui.header(href="/user/#{target.username}")
                //     |#{target.username}
                .ui.fluid.styled.accordion 
                    .active.title  
                        .ui.header  
                            +i name='about'
                            |about
                    .active.content
                        |!{description}
                // div 
                // .spacer
                // .spacer
                if location
                    // +location_map
                    .ui.header(title='location')
                        +i name='marker'
                        |#{location}
                .spacer
                // a(href="/m/room/#{event_room._id}")
                //     img.ui.small.circular.inline.image.pointer.zoom(src="{{c.url event_room.image_id }}" class=currentUser.invert_class)
                //     .ui.inline.header.pointer.zoom
                //         |#{event_room.title}
                // if is_admin
                if host
                    .ui.dividing.header 
                        i.chess.king.grey.icon
                        |host
                    a.ui.header.zoomer(href="/user/#{host.username}") 
                        img.ui.avatar.image(src="{{c.url host.image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                        |#{host.name}
                if support
                    .ui.dividing.header 
                        i.chess.queen.grey.icon
                        |support
                    a.ui.header(href="/user/#{support.username}") 
                        img.ui.avatar.image(src="{{c.url support.image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                        |#{support.name}
                if max_attendees
                    .ui.header
                        |#{max_attendees} max attendees
                // .ui.small.grey.header 
                //     i.line.chart.icon
                //     |stats
                .ui.small.header #{views} views
                each viewers
                    .ui.label #{username}
                with data_doc
                    +gcal_button
                .ui.hidden.divider
                div
                +array_view key='location_tags' label='location tags' icon='marker' 
                +rsvp



template(name='location_map')
    iframe(width='100%' height='350' frameborder='0' scrolling='no' marginheight='0' marginwidth='0' src="https://maps.google.com/maps?&amp;q=#{location}&amp;output=embed")




template(name='event_edit')
    .ui.stackable.grid
        .one.column.row 
            .column
                // if reservation_exists
                //     .ui.header date: #{date}
                //     .ui.header time: #{time}
                // else
                +text_edit key='location' label='location' icon='marker' 
                // +time_edit key='time' label='time' 
                +number_edit key='hour_duration' label='hours' 
                // +range_edit label='time range' 
                // +single_user_edit key='facilitator_id' label='facilitator' icon='chess king' 
                +boolean_edit key='manage_attendance' label='manage attendance' icon='settings' 
                if manage_attendance
                    .ui.header
                        i.users.icon
                        |audience
                    +number_edit key='max_attendees' label='max attendees' min='0' max='100' 
                    +boolean_edit key='friends_only' label='friends only' icon='campfire' 
                    // div
                +boolean_edit key='is_repeating' label='is repeating' icon='refresh' 
                if is_repeating
                    .ui.inline.header repeating day
                    +key_value_edit key='repeating_day' value='monday'
                    +key_value_edit key='repeating_day' value='tuesday'
                    +key_value_edit key='repeating_day' value='wednesday'
                    +key_value_edit key='repeating_day' value='thursday'
                    +key_value_edit key='repeating_day' value='friday'
                    +key_value_edit key='repeating_day' value='saturday'
                    +key_value_edit key='repeating_day' value='sunday'
                    div
                    +time_edit key='start_time' label='start time' 
                    +time_edit key='end_time' label='end time' 
                unless is_repeating 
                    div
                    +datetime_edit key='start_datetime' label='start datetime' icon='calendar'
                    div
                    +datetime_edit key='end_datetime' label='end datetime' icon='calendar'
                
                +boolean_edit key='has_host' label='has host' icon='king' 
                if has_host
                    +single_user_edit key='host_id' label='host' icon='shield' 
                +boolean_edit key='has_support' label='has support' icon='king' 
                if has_support
                    +single_user_edit key='support_id' label='support' icon='chess queen' 
                div 
                .ui.segment
                    +boolean_edit key='has_tickets' label='has tickets' icon='ticket' 
                    if has_tickets
                        +boolean_edit key='external_ticket_management' label='externally handled' 
                        if external_ticket_management
                            +link_edit key='link' label='link'
                            // +link_edit key='link' label='link'
                        else
                            +boolean_edit key='free' label='free' 
                            unless free
                                +number_edit key='price_points' label='point price' min='0' max='100' 
                            +number_edit key='price_usd' label='dollar price' min='0' max='100' 


template(name='group_card')
    .content
        a.ui.header
            |#{title}
        .ui.basic.label(title='member count')
            i.users.icon
            |#{member_count}
            // |members
        .ui.basic.label
            i.grey.eye.icon 
            |#{views}
        .smallcut
            |!{description}
        //+ismall name='tags' cl='ui inline image'
        each seven_tags
            .ui.label #{this}
        // if is_admin
        //     .ui.small.header slug: #{slug}
template(name='group_card_med')
    a.ui.card.zoomer.fly_right(href="/doc/#{_id}")
        if image_id
            img.ui.image(src="{{c.url image_id width=600 height=600}}")
        .content
            a.ui.header.zoomer
                |#{title}
            |#{member_ids.length} members
            .smallcut
                |!{description}
            //+ismall name='tags' cl='ui inline image'
            each seven_tags
                .ui.label #{this}
                    

template(name='group_item')
    if image_id
        img.ui.tiny.image(src="{{c.url image_id width=300 height=300}}")
    //     a.image.zoomer.fly_right(href="/doc/#{_id}")
    .middle.aligned.content
        a.ui.header.zoomer.fly_right(href="/doc/#{_id}")
            |#{title}
        |#{member_ids.length} members
        // .smallscroll
        //     |!{description}
        //+ismall name='tags' cl='ui inline image'
    .middle.aligned.content
        each seven_tags
            .ui.label #{this}
        if location 
            i.red.marker.icon 
            |#{location}
        .ui.label 
            i.grey.eye.icon 
            |#{views}
        // a.zoomer(href="/doc/#{_id}")
        //     i.chevron.right.large.circular.icon
        // if is_admin
        //     .ui.small.header slug: #{slug}
        // if can_edit
        //     a.ui.circular.icon.button(href="/doc/#{_id}/edit")
        //         i.pencil.blue.icon
        +print_this
                    


template(name='group_view')
    if premium_membership
        .ui.header 
            |premium membership: #{membership_cost}pts
        .ui.button.purchase_membership
            |purchase membership
    .spacer
    if link
        a.ui.circular.button(href=link target='_window')
            i.external.icon
            |#{link}
        .spacer
    div
    if address
        a.ui.compact.circular.button(href=address_link target='_window')
            i.marker.icon
            |#{address}
    if in_dev 
        i.circular.link.large.refresh.icon.refresh_group_stats
    .ui.two.column.stackable.padded.grid
        if has_members
            .column
                .ui.header
                    +i name='groups'
                    |people
                    .ui.button.add_user_member
                        |add member
                .ui.header members
                each _members 
                    .ui.header #{username}
                // +multi_user_view key='member_user_ids' label='members' direct=true
                +join_button
                if leaders_id
                    .ui.inline.header 
                        +i name='crown' cl='ui avatar image'
                        // i.crown.icon
                        |leaders: 
                    each leader_ids 
                        +user_info
                div
                .ui.inline.header 
                    +i name='groups'
                    // i.users.icon
                    |#{member_user_ids.length} members
                each member_user_ids
                    +user_info
        .column
            +checkin_widget
        .column
            .ui.dividing.header
                +i name='rss'
                |activity
            .content
                .ui.header 
                    +i name='line-chart'
                    // i.large.line.chart.icon
                    |stats
                .ui.large.list
                    .item 
                        i.user.icon
                        |#{member_user_ids.length} members
                    .item #{event_ids.length} events
                    .item #{transfer_ids.length} credits exchanged
            //     each log_items
            //         +log_item
            //     i.refresh.link.icon.refresh_group_stats
        .column
            if has_events
                .title
                    .ui.inline.header
                        +i name='calendar' 
                        // i.calendar.large.icon
                        |events
                .content
                    if currentUser 
                        .ui.icon.button.add_group_event(title='add group event')
                            i.plus.icon
                    .ui.link.animated.list
                        each group_events
                            a.item(href="/event/#{_id}") 
                                img.ui.avatar.image(src="{{c.url image_id width=200 height=200}}")
                                .content
                                    .header #{title}
                                    .description
                                        if is_repeating
                                            i.refresh.icon
                                            |every #{repeating_day}
                                        if start_datetime
                                            |{{from_now start_datetime}}
        .column
            if has_shop
                .title
                    .ui.header 
                        +i name='shop'
                        |shop
                .content
                    .ui.list 
                        each group_products 
                            a.item(href="/doc/#{_id}")
                                img.ui.avatar.image(src="{{c.url image_id width=200 height=200}}")
                                |#{title}
            
        .column
            if has_posts
                .title
                    .ui.inline.header 
                        +i name='blog'
                        |group posts
                    if currentUser 
                        .ui.icon.button.add_group_post(title='add group post')
                            i.plus.icon
                .content
                    .ui.selection.animated.list
                        each group_post_docs 
                            +post_item
        .column
            .ui.inline.header
                // i.info.icon
                +i name='info'
                |about
            .scrolling
                +html_view key='description' icon='content' label='description'
        .column
            .title
                .ui.header related groups
            .content
                .ui.header 
                    +i name='connect'
                    |related groups 
                .ui.list
                    each related_group_docs
                        +group_item
                






template(name='group_edit')
    .ui.stackable.padded.grid
        .row
            .sixteen.wide.column
                .ui.inline.header 
                    +i name='cube'
                    |modules
                +boolean_edit key='has_checkin' label='checkin' icon='clock' direct=true
                +boolean_edit key='has_shop' label='shop' icon='shop' direct=true
                +boolean_edit key='has_posts' label='posts' icon='blog' direct=true
                +boolean_edit key='has_events' label='events' icon='calendar' direct=true
                +boolean_edit key='has_chat' label='chat' icon='chat' direct=true
                +boolean_edit key='has_members' label='membership' icon='groups' direct=true
                if has_members 
                    .ui.segment 
                        .ui.header 
                            +i name='groups'
                            |membership settings
                        +boolean_edit key='premium_membership' label='premium' icon='membership-card'
                        if premium_membership
                            +number_edit key='membership_cost' label='cost (points)' icon='coins'
                
                // +single_user_edit key='leader_id' label='leader' icon='crown' direct=true
                +multi_user_edit key='leader_ids' label='leaders' icon='crown' direct=true
                div
                +array_edit key='location_tags' label='location tags' icon='marker' direct=true
                div
                +text_edit key='contact_info' label='contact info' icon='info' direct=true
                +multi_user_edit key='member_ids' label='members' direct=true
                +boolean_edit key='private' label='private' direct=true
                +link_edit key='link' label='link' direct=true
               
               
                    
                
                    
               

               
template(name='checkin_widget')
    .title
        .ui.inline.header 
            +i name='checkmark'
            |checkins
    .content
        if checked_in
            .ui.button.checkout  
                +i name='exit'
                |checkout
        else
            .ui.button.checkin
                +i name='internal'
                |checkin
        .ui.list
            each checkin_docs 
                .item 
                    strong 
                        if active 
                            i.large.green.clock.icon(title='active')
                        img.ui.avatar.image(src="{{c.url _author.image_id width=200 height=200}}")
                        |#{_author.username}
                    small #{when}

               

                                            
               

              
              
    
    
template(name='groups_small')
    a.ui.header.zoomer(href="/groups")
        +i name='groups'
        |groups
    .ui.selection.animated.list.smallscroll
        each group_docs
            a.item(href="/doc/#{_id}")
                img.ui.avatar.image(src="{{c.url image_id width=200 height=200}}")
                |#{title}
                
                
               
template(name='group_widget')
    if data_doc.group_id
        .ui.header 
            +i name='campfire'
            |related group
        with related_group_doc
            a.ui.card.fly_right(href="/doc/#{_id}")
                img.ui.image(src="{{c.url image_id width=500 height=500}}")
                .content
                    .ui.header 
                        |#{title}
                    |!{description}
               
                
template(name='group_picker')
    .ui.segment
        .ui.header 
            +i name='campfire'
            |related group
        // if is_admin
        // if group_doc
        with group_doc
            .ui.header 
                |picked group: #{group_id}
            a.ui.big.basic.label(href="/doc/#{_id}")
                img.ui.avatar.image(src="{{c.url image_id width=300 height=300 gravity='face' crop='fill'}}")
                |#{title}
            .ui.compact.button.remove_group.zoomer(title='clear selection')
                i.remove.large.icon
                |remove
        else 
            .ui.icon.large.input 
                if group_search_value
                    i.large.red.remove.link.icon.zoomer.clear_search
                else 
                    i.search.icon
                input.group_search(type='text' placeholder='search' value=group_search_value)
            if group_results
                .ui.selection.link.animated.list
                    each group_results
                        .ui.item.pick_group.zoomer
                            img.ui.avatar.image(src="{{c.url image_id width=300 height=300 gravity='face' crop='fill'}}")
                            |#{title}
                            if private 
                                i.lock.icon(title='private group')
            // else if group_search_value
            .ui.button.create_group
                |add #{group_search_value}
        
                
                
                
template(name='rental_item')
    .ui.inline.header 
        |#{daily_rate}
        small p/day
    // if tags
    //     i.tag.icon
    // each tags
    //     a.ui.small.link.black.label.flat_pick_tag.spaced #{this}
    // .right.floated.meta
    //     | added #{when}
    // unless anonymous
    //     a(href="/user/#{_author_username}")
    //         img.ui.avatar.image(src="{{c.url _author.image_id width=400 height=600 crop='fit'}}")
    //         |#{_author_username}
template(name='rental_card')
    .ui.card(class=rental_card_class)
        .content
            a.header.zoomer.fly_right(href="/doc/#{_id}/") 
                | #{title}
            div
            .ui.inline.header 
                |#{daily_rate}
                small p/day
            // if tags
            //     i.tag.icon
            // each tags
            //     a.ui.small.link.black.label.flat_pick_tag.spaced #{this}
            // .right.floated.meta
            //     | added #{when}
            unless anonymous
                a(href="/user/#{_author_username}")
                    img.ui.avatar.image(src="{{c.url _author.image_id width=400 height=600 crop='fit'}}")
                    |#{_author_username}
template(name='rental_big_card')
    .ui.fluid.segment
        .ui.fluid.two.column.grid(class=rental_card_class)
            .column
                a.image.fly_right(href="/doc/#{_id}/") 
                    if image_id
                        img.ui.zoomer.pointer.goto_rental.image(src="{{c.url image_id width=400 height=300 crop='pad'}}")
            .column
                a.header.zoomer.fly_right(href="/doc/#{_id}/") 
                    | #{title}
                div
                .ui.inline.header 
                    |#{daily_rate}
                    small p/day
                // if tags
                //     i.tag.icon
                // each tags
                //     a.ui.small.link.black.label.flat_pick_tag.spaced #{this}
                // .right.floated.meta
                //     | added #{when}
                unless anonymous
                    a(href="/user/#{_author_username}")
                        img.ui.avatar.image(src="{{c.url _author.image_id width=400 height=600 crop='fit'}}")
                        |#{_author_username}
                // +quickbuy day_diff=0
                +quickbuy day_diff=1
                +quickbuy day_diff=2
                +quickbuy day_diff=3
                +quickbuy day_diff=4
                +quickbuy day_diff=5

template(name='user_rentals')
    .ui.header 
        +i name='shopping-cart'
        |#{user_rental_docs.count} rentals
    .ui.selection.animated.large.list
        each user_rental_docs 
            a.item(href="/doc/#{_id}") 
                img.ui.avatar.image(src="{{c.url image_id width=300 height=300 gravity='face' crop='fill'}}")
                .content
                    .title 
                        |#{title}
                        strong #{daily_rate}p/day
    .ui.header 
        +i name='order-history'
        |rented to
    .ui.items
        each received_orders
            +profile_order_item
    .ui.header 
        +i name='clock'
        |rented from
    .smallscroll
        .ui.items
            each purchased_orders
                +profile_order_item


template(name='rental_view')
    .ui.header 
        +i name='order-history'
        |#{past_order_docs.count}
        |past orders
    .ui.selection.animated.large.middle.aligned.divided.list
        each past_order_docs
            .item
                .right.floated.content
                    a(href="/order/#{_id}")
                        i.chevron.right.circular.icon
                .content
                    a(href="user/#{_author_username}")
                        | #{_author_username}
                        small for
                        |#{order_date}
    +text_view key='location' icon='marker' label='location' direct=true
    .ui.header #{daily_rate}p/day
    //- unless is_author
    // .ui.big.green.fluid.button.new_order 
    //     i.large.clock.icon
    //     small reserve for 
    //     strong #{daily_rate}p/day
    // +quickbuy day_diff=0
    +quickbuy day_diff=1
    +quickbuy day_diff=2
    +quickbuy day_diff=3
    +quickbuy day_diff=4
    +quickbuy day_diff=5
    div
    if description.length
        +html_view key='description' label='description' icon='content' direct=true
    div
    .ui.small.list
        .item total earnings
        .item rental ranking #orders
        .item rental ranking $ earned
        .item # different renters
        .item avg rental time
        .item avg daily earnings
        .item avg weekly earnings
        .item avg monthly earnings
        .item biggest renter
        .item predicted payback duration
        .item predicted payback date
    .ui.header 
        +i name='clock'
        |#{future_order_docs.count}
        |future orders
    .ui.link.large.divided.middle.aligned.list
        each future_order_docs
            .item
                .right.floated.content
                    a(href="/order/#{_id}")
                        i.chevron.right.circular.icon
                    if can_edit
                        i.red.circular.cancel.link.icon.zoomer.cancel_order
                .content
                    a(href="/user/#{_author_username}")
                        img.ui.avatar.image(src="{{c.url _author.image_id width=200 height=200 crop='crop'}}")
                        | #{_author_username}
                    small for
                    |#{order_date}, {{from_now order_date}}
    +rental_stats
    // +last_viewed
            +creation_info
template(name='quickbuy')
    .ui.basic.green.button.buy(class=button_class)
        i.lightning.icon
        | #{human_form}
        small #{from_form}
        

template(name='rental_edit')
    .ui.stackable.padded.grid
        .one.column.row
            .column
                +number_edit key='daily_rate' label='daily rate' icon='exchange' direct=true
                div
                if lat
                    a.ui.header.pointer.refresh_gps(href='#') 
                        |gps coords
                    .ui.label #{lat}
                    .ui.label #{long}
                // +text_edit key='location' label='location text' icon='marker' direct=true
            .column
                +array_edit key='location_tags' label='public location tags' icon='marker' direct=true
                // +array_edit key='private_location_tags' label='private location tags' icon='marker' direct=true tooltip='for handlers and buyers who are picking up'
    
                    
template(name='last_viewed')
    i.large.grey.eye.icon
    .ui.inline.small.header last viewed {{long_date last_viewed_timestamp}}
    .ui.inline.small.header {{from_now last_viewed_timestamp}}
                    
                    

template(name='rental_stats')
    //- .ui.accordion
    //-     .title
    .ui.grey.header.refresh_rental_stats
        i.line.chart.icon
        |stats
    //- .content
    .ui.big.list
        .item #{views} views
        .item #{order_count} orders
        .item #{total_earnings}p/#{total_rental_hours}hrs total
        // .item #{average_rental_cost}c / #{average_rental_duration}hrs avg rental
        //- .item rental ranking # orders
        //- .item rental ranking $ earned
        //- .item # different renters
        //- .item avg daily earnings
        //- .item avg weekly earnings
        //- .item avg monthly earnings
        //- .item biggest renter
        //- .item predicted payback duration 
        //- .item predicted payback date 
    //-     //- .ui.header res slot exists
    //-     +order_slot_template
    //- else
    //-     if is_product_author
    //-         .ui.button.new_slot
    //-             |new slot
        
    
template(name='set_date_filter')        
    .ui.button.set_date_filter(class=date_filter_class)
        |#{label}
        
        

template(name='order_segment')
    .ui.segment
        a.ui.small.header.inline.lowercase(href="/order/#{_id}/")
            small from 
            |{{cal_time start_datetime}}
            //- |{{cal_time start_datetime}} [#{start_date}, hour: #{start_hour}]
            //- |{{long_date start_datetime}}
            small to 
            |{{cal_time end_datetime}}
        //- .ui.inline.header #{_author_username}
        .ui.inline.header #{author.name}
        .ui.grey.inline.header #{hour_duration}hrs
        .ui.grey.inline.header(title='credits')
            | $#{cost}
        .ui.small.inline.header #{when} by #{_author_username}
        a.ui.large.button(href="/order/#{_id}/")
            |view
            i.right.chevron.icon
                
                
// template(name='user_rentals')
//     .scrolling
//         if is_current_user
//             .ui.button.add_rental
//                 i.plus.icon
//                 |rental
//         each rentals
//             +profile_rental_item

// template(name='profile_rental_item')
//     .ui.segment.grid
//         .row
//             .three.column
//                 +image_view key='image' direct=true cl='zoom ui tiny image'
//             .twelve.wide.column
//                 .ui.header #{title}
//                 a.ui.header.inline.lowercase(href="/doc/#{_id}/")
//                     |#{daily_rate}p/day
//                 .ui.small.inline.header #{when}
//                 a.ui.button(href="/doc/#{_id}/")
//                     |view
//                     i.right.chevron.icon


        
template(name='user_rental_card')
    .ui.small.card
        a.zoom(href="/doc/#{_id}/")
            img.ui.centered.image(src="{{c.url image_id height=200 width=200 background='white' crop='pad'}}")
        .content
            a.ui.inline.header(href="/doc/#{_id}/") #{title} 
                .ui.label #{daily_rate}p/day
            +rental_status
        .content
            span(title='views')
                +ismall name='eye'
                |#{views}
            div
            +ismall name='marker'
            each location_tags
                .ui.label #{this}
            div
            +ismall name='tags'
            each tags
                .ui.label #{this}
            div
            a.ui.button(href="/doc/#{_id}/")
                |view
                i.right.chevron.icon
                
                
template(name='transfer_card')
    if image_id
        a.image.zoomer.fly_right(href="/doc/#{_id}")
            img.ui.image(src="{{c.url image_id width=600 height=600}}")
    .content
        with _target
            +user_info
        with _author
            +user_info
        each tags
            .ui.label #{this}
        .smallscroll
            |!{description}
        // +ismall name='tags' cl='ui inline image'
        +view_span
        // if is_admin
        //     .ui.small.header slug: #{slug}
     
     
template(name='view_span')
    span(title='views')
        i.grey.eye.icon 
        |#{views}
                    
template(name='transfer_item')
    .item
        if image_id
            a.image.zoomer.fly_right(href="/doc/#{_id}")
                img.ui.image(src="{{c.url image_id width=600 height=600}}")
        .content
            with _target
                +user_info
            with _author
                +user_info
            .ui.label 
                |#{when}
            each seven_tags
                .ui.label #{this}
            span.smallscroll
                |!{description}
            // +ismall name='tags' cl='ui inline image'
            a.ui.icon.button.zoomer.fly_right(href="/doc/#{_id}")
                i.chevron.right.icon
            +view_span
            // if is_admin
            //     .ui.small.header slug: #{slug}
            +print_this
                    

template(name='transfer_view')
    .ui.stackable.padded.grid
        .centered.row 
            .five.wide.column
                a(href="/user/#{_author.username}") 
                    img.ui.circular.centered.pointer.zoom.image(src="{{c.url _author.image_id height=500 width=500 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                    .ui.large.center.aligned.header.pointer.zoom
                        |#{_author.name}
            .five.wide.column
                .ui.huge.center.aligned.header
                    |#{amount}pts
                if in_dev
                    +remove_button
                    a.ui.icon.button(href="/doc/#{_id}/edit")
                        i.pencil.icon
                .f14
                    |!{description}
                .spacer
                
                +image_view key='image_id' label='image' direct=true
                div 
                if tags
                    i.tags.icon
                    each tags 
                        .ui.big.basic.circular.label #{this}
                +print_this
                .ui.small.header
                    i.clock.icon
                    | #{when}
                .spacer
                .spacer
                //- +array_view key='location_tags' label='location_tags' direct=true
            .five.wide.column
                a.fly_right(href="/user/#{_target.username}")
                    img.ui.circular.centered.fluid.pointer.zoom.image(src="{{c.url _target.image_id height=500 width=500 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                    .ui.large.center.aligned.header.pointer.zoom
                        |#{_target.name}
                            

template(name='transfer_edit')
    .ui.stackable.padded.grid
        .row 
            .sixteen.wide.column
                .ui.segment
                    .ui.inline.grey.header sender
                    .ui.inline.header
                        img.ui.small.image(src="{{c.url _author.image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                        |#{_author.name}
                .ui.segment
                    .ui.header _target
                    with _target
                        i.large.remove.link.icon.remove_target
                        a.pointer(href="/user/#{name}")
                            img.ui.tiny.inline.image(src="{{c.url image_id height=400 width=400 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                            .ui.inline.header #{name}
                            .ui.small.grey.inline.header #{points}
                    unless _target
                        .ui.divider
                        // i.large.user.plus.icon
                        +single_user_edit key='target_user_id' label='search member' icon='user plus' direct=true
                        // .ui.icon.input
                        //     i.search.icon
                        //     input.search_username(type='text' placeholder='username')
                        // each members
                        //     .ui.compact.basic.circular.button.add__target
                        //         // i.plus.icon
                        //         img.ui.avatar.image(src="{{c.url profile_image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                        //         |#{name}
                        //         small #{points}p
                // +boolean_edit key='has_date' label='has date' icon='calendar' direct=true
                // if has_date
                +date_edit key='date' label='date' direct=true   
                // +boolean_edit key='has_time' label='has time' icon='clock' direct=true
                // if has_time
                +time_edit key='time' label='time' direct=true   
                +array_edit key='location_tags' label='location tags' icon='marker' direct=true
                .ui.big.header #{amount}pts
                .ui.big.input
                    input.point_amount(type='number' value=amount min='1' max=point_max)
                div
                +key_value_edit key='amount' value=1
                +key_value_edit key='amount' value=5
                +key_value_edit key='amount' value=10
                +key_value_edit key='amount' value=20
                +key_value_edit key='amount' value=50
                .spacer
                .ui.center.aligned.basic.segment
                    if can_submit
                        .ui.green.huge.circular.button.submit
                            i.big.send.icon
                            |send
                    else 
                        .ui.green.huge.circular.disabled.button
                            i.send.big.icon
                            |send
                            
                                
                                
                        
                        
template(name='task_card')
    .ui.card.view_task.pointer.fly_right
        img.ui.fluid.rounded.image(src="{{c.url image_id height=200 width=400 gravity='face' crop='fill'}}" class=currentUser.invert_class)
        .content
            a.ui.header(href="/doc/#{_id}") #{title}
            if private 
                i.large.lock.icon
            .ui.small.grey.header #{when}
            .smallscroll
                | !{content}
            +author_info
            if group_id     
                +group_info
            
        
template(name='task_item')
    +boolean_view key='complete'        

template(name='task_view')
    .ui.stackable.padded.grid
        .row 
            .four.wide.column
                .ui.inline.grey.header {{from_now start_datetime}}
                
                if can_edit
                    a.ui.circular.icon.button.edit_task(href="/doc/#{_id}/edit" title='edit')
                        +i name='pencil'
                .ui.segment
                    .ui.header 
                        small author
                    a.ui.header(href="/user/#{_author.username}") 
                        img.ui.avatar.image(src="{{c.url _author.image_id height=200 width=200 gravity='face' crop='fill'}}" class=currentUser.invert_class)
                        |#{_author.username}
                .ui.list
                    .item #{views} views
                each viewers
                    .ui.label #{username
                +array_view key='tags' label='tags' direct=true
                +array_view key='location_tags' label='location_tags' direct=true
                +visibility_settings
                +group_widget
            .twelve.wide.column.scrolling
                .ui.header #{title}
                img.ui.rounded.image(src="{{c.url image_id }}" class=currentUser.invert_class)
                // a.ui.header(href="/user/#{target.username}")
                //     |#{target.username}
                |!{content}
                div 
                .spacer
                .spacer
            // .four.wide.column
            
                //- .ui.fluid.green.button.submit
                //-     i.checkmark.icon
                //-     |submit





template(name='task_edit')
    .ui.stackable.padded.grid
        .row 
            .sixteen.wide.column
                .ui.header
                    |audience
                +boolean_edit key='private' label='private' 
                if private 
                    +multi_user_edit key='access_user_ids' label='user picker' direct=true
                // +boolean_edit key='has_content' icon='content' direct=true
                // if has_content
                +array_edit key='location_tags' label='location tags' icon='marker' direct=true