template(name='profile_layout')
    +nav
    .ui.bottom.attached.pushable.segment.scrolling
        +topbar
        +leftbar
        +rightbar
        with user_from_username_param
            if background_image_id
                img.ui.image.checkin_banner(src="{{c.url background_image_id height=1000 crop='crop'}}")
            else 
                img.ui.image.checkin_banner(src="{{c.url image_id height=1000 crop='crop'}}")
            // img.ui.fluid.image.checkin_banner(src="{{c.url 'frontrange' width=1000 height=1000 crop='crop'}}")
            .ui.stackable.padded.grid
                .row
                    //- img.ui.image.checkin_banner(src="{{c.url banner_image width=1000 height=1000 crop='crop'}}")
                    .four.wide.column
                        +profile_left_column
                    .twelve.wide.column
                        a.ui.compact.circular.button(href="/user/#{username}")
                            +i name='dashboard'
                            |dashboard
                        +profile_menu_item key='points' icon='coins'
                        +profile_menu_item key='points' icon='coins'
                        +profile_menu_item key='social' icon='friends'
                        +profile_menu_item key='posts' icon='blog'
                        +profile_menu_item key='products' icon='shop'
                        +profile_menu_item key='rentals' icon='clock'
                        +profile_menu_item key='services' icon='wrench'
                        +profile_menu_item key='groups' icon='groups'
                        +profile_menu_item key='comments' icon='chat'
                        .scrolling
                            if subs_ready
                                +yield
                            else 
                                .ui.basic.center.aligned.segment
                                    i.massive.loading.refresh.icon
                          
template(name='profile_left_column')                          
    a.item(href="/user/#{username}")
        img.ui.centered.rounded.image.boop(src="{{c.url image_id height=500 width=500 gravity='face' crop='fill'}}")
    .spacer
    a(href="/user/#{username}")
        .ui.header
            strong @#{username}
            //- small @#{user.username}        
        a.ui.header(href="/user/#{username}/points" title='points')
            //- +i name='coins'
            //- i.coins.icon
            |#{points} pts
    if first_name
        .ui.inline.header #{first_name}
    if last_name
        .ui.inline.header #{last_name}
    div
    if company 
        .ui.header
            +i name='business' 
            |#{company}
    if linkedin_link
        .ui.circular.compact.button(href=linkedin_link target='_window')
            +i name='linkedin'
    if twitter_link
        .ui.circular.compact.button(href=twitter_link target='_window')
            +i name='twitter'
    a.ui.large.icon.compact.button(href="/user/#{username}/edit" title='profile settings')
        i.cog.large.icon
        |account
    .ui.list 
        .item 
            i.eye.grey.icon
            |#{profile_views} 
            |profile views
        .item 
            i.lock.grey.icon
            |#{profile_views_anon} 
            |anon views
        .item 
            i.user.grey.icon
            |#{profile_views_logged_in} 
            |logged in views
    .ui.center.aligned.inline.header(title='boops')
        +i name='tap-gesture'
        |#{boops}

    if is_admin
        a.ui.icon.button(href="/user/#{user_from_username_param.username}/edit" title='profile settings')
            +i name='settings' cl='ui avatar image'
    if is_current_user
        +logout_button
        +logout_other_clients_button
    if in_dev 
        +print_this
    +send_points_button
    +request_button
    // i.refresh.link.icon.calc_user_points
                          
                          
                            
template(name='profile_menu_item')
    a.ui.compact.circular.button(href="/user/#{current_user.username}/#{key}")
        +i name=icon
        |#{key}
                 
                 
template(name='user_points')                 
    .ui.header 
        +i name='coins'
        |user balance
    .ui.header
        |points in
    .ui.list
        each points_in_docs
            .ui.inline.header #{body} 
            |{amount}pts
    .ui.header
        |points out
    .ui.list
        each points_out_docs
            .ui.inline.header #{body} 
            |{amount}pts
    
    
                 
template(name='user_products')                 
    .ui.header 
        +i name='shop'
        |user products
                 
                 
template(name='user_groups')                 
    .ui.header 
        +i name='groups'
        |user groups
    a.ui.button.fly_right(href="/groups")
        +i name='campfire'
        |groups
    .ui.list    
        each group_memberships
            a.item(href="/group/#{_id}") #{title}
                 
template(name='user_social')
    .ui.header 
        +i name='friends'
        |user social
    +user_friends   
                    
template(name='user_dashboard')
    .ui.padded.grid 
        .two.column.row
            .column
                +user_messages
                if is_current_user
                    .column
                        +profile_deposits
            .column
                +user_reviews
            .column
                +user_posts
                a.ui.header(href="/groups")
                    +i name='groups'
                    |groups
                .ui.list
                    each user_groups
                        a.item(href="/group/#{_id}") #{title}
            .column
                if user_is_resident
                    +user_resident_info
                +user_friends
            .column
                +user_rentals
            .column
                +user_credit
   
   
template(name='user_friends')
    .ui.header 
        +i name='friends'
        |friends
    .ui.selection.link.animated.list
        each user_friended
            +user_info
    .ui.selection.link.animated.list
        each user_friended_by
            +user_info
  
template(name='user_resident_info')   
    //- if is_staff
    +number_view key='unit_number' label='Unit #' direct=true
    +number_view key='building_number' label='Building #' direct=true
    +number_view key='healthclub_code' label='Healthclub Code' direct=true
    +text_view key='building_code' label='Building Code' direct=true
    +date_view key='start_date' label='Start Date' direct=true
    +date_view key='expiration_date' label='Expiration Date' direct=true
   
template(name="user_messages")               
    .ui.header 
        +i name='envelope'
        |messages
    +send_message_button
    .ui.small.header
        +i name='sent'
        |sent
    .ui.list 
        each user_messages_sent
            |#{body}
    .ui.small.header
        +i name='internal'
        |received
    .ui.list 
        each user_messages_received
            |#{body}
            
            
template(name='send_message_button')
    .ui.button.send_message
        |send message
            
template(name="user_reviews")               
    .ui.header 
        +i name='star'
        |reviews
    .ui.list 
        each user_review_docs
            |#{amount}

template(name='user_posts')
    .ui.header 
        +i name='blog'
        |user posts
    .ui.selection.link.animated.large.divided.list
        each user_model_docs 'post'
            a.item.fly_left(href="/post/#{_id}") 
                if image_id
                    img.ui.small.inline.image(src="{{c.url image_id height=200 width=200 background='white' crop='pad'}}")
                .content 
                    .header
                        |#{title}
                    .description
                        |#{when}

template(name='profile_deposits')
    .ui.header 
        +i name='donate'
        |deposits
    // |includes 2% points card processing fee
    .ui.action.fluid.input
        input.deposit_amount(type='number' min='1' placeholder='deposit')
        .ui.icon.button.add_points   
            i.right.chevron.icon
            
    .ui.large.bulleted.list.smallscroll
        each deposit_docs
            .item 
                .content
                    .header 
                        |$#{amount}
                    .description #{when} {{long_date _timestamp}}
                    //- if is_dev
                    +remove_button






template(name='user_credit')
    .ui.header 
        +i name='donate'
        |points sent
    .scrolling
        .ui.items
            each sent_transfer_docs
                +transfer_item
    .ui.header 
        +i name='internal'
        |points received
    .ui.button.send_points
        i.send.icon
        |send points
    .scrolling
        .ui.items
            each received_transfer_docs
                +transfer_item



template(name='logout_other_clients_button')
    .ui.compact.button.logout_other_clients(title='logout other clients')
        +i name='globe'
        |log out other clients



template(name='logout_button')
    .ui.large.compact.button.logout(title='log out')
        // i.sign.out.alternate.icon
        +i name='exit'
        |log out


// template(name='profile_order_item')
//     .ui.segment.grid
//         .row
//             .column
//                 .ui.header #{rental.title}
//         .row
//             .column
//                 with rental
//                     //- img.ui.mini.image(src=image)
//                     +image_view key='image_id' direct=true cl='zoom ui tiny image'
//             .column
//                 a.ui.header.inline.lowercase(href="/order/#{_id}/")
//                     small from 
//                     |{{cal_time start_datetime}}
//                 a.ui.header.inline.lowercase(href="/order/#{_id}/")
//                     small to 
//                     |{{cal_time end_datetime}}
//                 div
//                 .ui.grey.inline.header #{hour_duration} hrs
//                 .ui.grey.inline.header(title='pointss')
//                     i.coins.icon
//                     | #{cost}
//                 .ui.small.inline.header #{when} by #{_author_username}
//                 a.ui.large.button(href="/order/#{_id}/")
//                     |view
//                     i.right.chevron.icon
//                 if is_admin
//                     +remove_button






template(name='user_edit')
    with user_from_username_param          
        //- img.ui.fluid.image.checkin_banner(src="{{c.url banner_image_id width=1000 height=500 crop='crop'}}")    
        .ui.stackable.padded.grid
            .three.column.row
                .column
                    .ui.center.aligned.large.inline.grey.header
                    //- +i name='pencil'
                    .ui.small.inline.header @#{username}
                    a.ui.green.fluid.icon.button(href="/user/#{username}/") 
                        i.checkmark.large.icon
                    .ui.hidden.divider
                    +image_edit key='image_id' icon='picture' title='profile image' direct=true
                    +image_edit key='background_image_id' icon='image' title='background image' direct=true
                .column
                    if is_current_user
                        +password_edit
                        //- +phone_editor
                        +username_edit
                    else if in_dev
                        +password_edit
                        //- +phone_editor
                        +username_edit
                    // if is_admin
                    with user_from_username_param
                        .ui.orange.button.remove_user 
                            i.remove.icon
                            |delete user
                    if in_dev
                        +boolean_edit key='admin' label='admin' icon='shield'
                    +text_edit key='first_name' label='first name'
                    +text_edit key='last_name' label='last name'
                    +text_edit key='display_name' label='display name'
                    +html_edit key='bio' label='bio'

                .column
                    .ui.dividing.header 
                        +i name='money'
                        |preferred payment received method
                        .ui.button
                            +i name='apple-pay'
                            |apple pay
                        .ui.button
                            +i name='paypal'
                            |paypal
                        .ui.button 
                            +i name='venmo'
                            |venmo
                
                    .ui.header 
                        i.envelope.outline.icon
                        |emails
                    +emails_edit
                    +phone_edit key='phone' label='phone' icon='phone' direct=true
                    +color_edit key='theme_color_main' label='main theme color' direct=true
                    +text_edit key='address' label='address' icon='marker' 
                    +text_edit key='city' label='city' icon='marker' 
                    +text_edit key='state' label='state' icon='marker' 
                    +phone_edit key='phone' label='phone' icon='phone' 
                    +text_edit key='company' label='company' icon='business'
                    +text_edit key='linkedin_link' label='LinkedIn profile ' icon='linkedin'
                    +text_edit key='twitter_link' label='twitter profile ' icon='twitter'
                    +text_edit key='facebook_link' label='facebook profile ' icon='facebook'


template(name='user_single_doc_ref_editor')
    .ui.header #{label}
    each choices
        .ui.button.select_choice(class=choice_class title=title)
            i.icon(class=icon)
            |#{title}

template(name='username_edit')
    .ui.small.header 
        i.i.cursor.icon
        |change username [#{user_from_username_param.username}]
    .ui.icon.fluid.input
        input.new_username(type='text' placeholder='new username...')
        i.play.link.icon.change_username


     
template(name='phone_editor')
    .ui.small.header    
        i.phone.icon
        |phone
    .ui.icon.fluid.input(title='Add Phone')
        i.plus.icon
        input#phone.form-control(type='phone', name='phone', value='{{newNumber}}')
    if user_from_username_param.profile.phone
        if user_from_username_param.profile.phone_verified
            .ui.label verified
        else
            p
                .ui.label not verified
                a.resend_verification(href='#')
                    |resend code
                .ui.small.icon.button.remove_phone(title='remove phone')
                    i.remove.icon
    else
        .ui.fluid.button.update_phone add phone



template(name='password_edit')
    .ui.small.grey.header
        +i name='password'
        |change password
    //- .ui.fluid.input
    //-     input#password(type='password', placeholder='old password')
    .ui.fluid.icon.input
        input#new_password(type='password', placeholder='new password')
    // if is_dev
    //     .ui.fluid.button.send_enrollment_email
    //         |send enrollment email
    // if is_admin
    //     .ui.fluid.button.reset_password
    //         |reset password
    .ui.fluid.large.button.set_password
        +i name='password' cl='ui mini inline image'
        | set password
            
            
            
         
         
template(name='user_field')         
    .ui.form
        .field  
            label #{label}
            input.user_field(type='text' value=key_value)
                        
                        
            
template(name='emails_edit')
    //- .ui.small.grey.header 
    //-     i.envelope.icon
    //-     | email(s)
    //- #test_email.ui.big.button test email
    .ui.divided.list
        each current_user.emails
            .item 
                // unless verified
                //     .right.floated.content
                //         .ui.button Verify
                .content
                    if verified
                        .ui.big.label(title='verified')
                            | #{address}
                            i.checkmark.icon
                    else
                        .ui.big.label
                            //- i.ban.icon
                            | #{address}
                        if is_staff
                            .send_verification_email.ui.button 
                                |verify
                                i.caret.right.icon
                    .ui.small.icon.button.remove_email
                        i.remove.icon
    .ui.action.fluid.icon.action.input
        input#new_email(type='email' placeholder='add new email address' autocomplete="off")
        #add_email.ui.submit.icon.button 
            i.plus.icon
            //- |email

