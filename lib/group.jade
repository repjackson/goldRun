template(name='groups')
    .ui.stackable.padded.grid
        .four.wide.column
            .ui.inline.header 
                +i name='campfire'
                // i.fire.large.icon
                |#{group_docs.count}
                |groups
            if currentUser
                a.ui.icon.circular.button.add_group(title='add')
                    i.plus.green.large.icon
            .ui.button.toggle_my_groups
                i.user.icon
                |mine
            .ui.button.toggle_private_groups
                i.lock.icon
                |private
            +search_input key='title'
            // if selected_tag_plural
            //     .ui.icon.circular.black.compact.button.clear_picked_tags
            //         i.remove.icon
            +facet key='tag'
            span.sorting_row
                .ui.icon.input
                    i.search.icon
                    input.search_group(type='text' placeholder='search...' value=current_group_search)
                // |sort by
                // .ui.compact.small.menu
                //     .ui.simple.dropdown.item
                //         strong #{current_group_sort_label}
                //         i.dropdown.icon
                //         .menu
                //             +set_sort_key key='member_ids' label='$/serving' icon='money'
                //             +set_sort_key key='private' label='available' icon='clock'
                //             +set_sort_key key='_timestamp' label='added' icon='clock'
                //             +set_sort_key key='comment_count' label='comment count' icon='chat'
                +toggle_sort_direction
            // +session_set key='view_mode' value='grid' icon='th'
            // +session_set key='view_mode' value='list' icon='list'
            // if session_is 'view_mode' 'grid'
            i.big.clock.grey.icon(title='when tags')
            if selected_time_tags
                each selected_time_tags
                    a.unselect_time_tag.ui.active.large.compact.button(href='#')
                        strong #{this}
            each time_tags
                a.ui.basic.large.label.zoomer.select_time_tag(title="#{count} results" class="#{selector_class} #{thinking_class}")
                    strong #{name}
            div
            i.big.smile.grey.icon(title='where tags')
            if picked_emotion
                each picked_emotion
                    a.unpick_emotion.ui.active.large.compact.button(href='#')
                        strong #{this}
            each emotion_results
                if name
                    a.ui.basic.large.label.zoomer.pick_emotion(title="#{count} results" class="#{selector_class} #{thinking_class}")
                        strong #{name}
            div
            div
            i.big.marker.grey.icon(title='where tags')
            if selected_location_tags
                each selected_location_tags
                    a.unselect_location_tag.ui.active.large.compact.button(href='#')
                        strong #{this}
            each location_tags
                a.ui.basic.large.label.zoomer.select_location_tag(title="#{count} results" class="#{selector_class} #{thinking_class}")
                    strong #{name}
            div
            i.big.users.grey.icon(title='where tags')
            if selected_people_tags
                each selected_people_tags
                    a.unselect_people_tag.ui.active.large.compact.button(href='#')
                        strong #{this}
            each people_tags
                a.ui.basic.large.label.zoomer.select_people_tag(title="#{count} results" class="#{selector_class} #{thinking_class}")
                    strong #{name}
            div
            i.big.marker.grey.icon(title='where tags')
            if selected_timestamp_tags
                each selected_timestamp_tags
                    a.unselect_timestamp_tag.ui.active.large.compact.button(href='#')
                        strong #{this}
            each timestamp_tags
                a.ui.basic.large.label.zoomer.select_timestamp_tag(title="#{count} results" class="#{selector_class} #{thinking_class}")
                    strong #{name}
            .ui.hidden.divider
            with emotion_avg
                // .ui.list
                //     .item {{ to_percent avg_sent_score}}% sentiment
                //     .item {{ to_percent avg_joy_score}}% joy
                //     .item {{ to_percent avg_anger_score}}% anger
                //     .item {{ to_percent avg_sadness_score}}% sad
                //     .item {{ to_percent avg_disgust_score}}% disgust
                //     .item {{ to_percent avg_fear_score}}% fear
                if kv_is 'doc_sentiment_label' 'positive'
                    span.say.ui.green.text(class="{{calculated_size doc_sentiment_score}}") {{ to_percent doc_sentiment_score }}% #{doc_sentiment_label}
                        |&nbsp;
                    div.rounded(style="height:5px;width:{{to_percent doc_sentiment_score}}%;background-color:green" title="{{to_percent doc_sentiment_score}}% #{doc_sentiment_label}")
                else if kv_is 'doc_sentiment_label' 'negative'
                    span.say.ui.red.text(class="{{calculated_size doc_sentiment_score}}") {{ to_percent doc_sentiment_score }}%  #{doc_sentiment_label} 
                        |&nbsp;
                    div.rounded(style="height:5px;width:{{abs_percent doc_sentiment_score}}%;background-color:red" title="{{abs_percent doc_sentiment_score}}% #{doc_sentiment_label}")
                    
                span.say.ui.green.text(class="{{calculated_size avg_sent_score}}") {{ to_percent avg_sent_score }}% joy 
                    |&nbsp;
                div.rounded(style="height:5px;width:{{to_percent avg_sent_score}}%;background-color:green" title="{{to_percent avg_sent_score}}% joy")
      
                span.say.ui.green.text(class="{{calculated_size avg_joy_score}}") {{ to_percent avg_joy_score }}% joy 
                    |&nbsp;
                div.rounded(style="height:5px;width:{{to_percent avg_joy_score}}%;background-color:green" title="{{to_percent avg_joy_score}}% joy")
                //- if above_50 'avg_sadness_score'
                    //- .spacer
                span.say.ui.blue.text(class="{{calculated_size avg_sadness_score}}") {{ to_percent avg_sadness_score}}% sad 
                    |&nbsp;
                div.rounded(style="height:5px;width:{{to_percent avg_sadness_score}}%;background-color:blue" title="{{to_percent avg_sadness_score}}% sad")
                //- if above_50 'avg_fear_score'
                    //- .spacer
                span.say.ui.grey.text(class="{{calculated_size avg_fear_score}}") {{ to_percent avg_fear_score }}% fear 
                    |&nbsp;
                div.rounded(style="height:5px;width:{{to_percent avg_fear_score}}%;background-color:grey" title="{{to_percent avg_fear_score}}% fear")
                //- if above_50 'avg_disgust_score'
                    //- .spacer
                span.say.ui.orange.text(class="{{calculated_size avg_disgust_score}}") {{ to_percent avg_disgust_score }}% disgust 
                    |&nbsp;
                div.rounded(style="height:5px;width:{{to_percent avg_disgust_score}}%;background-color:orange" title="{{to_percent avg_disgust_score}}% disgust")
                //- if above_50 'avg_anger_score'
                    //- .spacer
                span.say.ui.red.text(class="{{calculated_size avg_anger_score}}") {{ to_percent avg_anger_score }}% anger 
                    |&nbsp;
                div.rounded(style="height:5px;width:{{to_percent avg_anger_score}}%;background-color:red" title="{{to_percent avg_anger_score}}% anger")
        .twelve.wide.column
            |sort by
            +toggle_sort_direction
            +session_set key='sort_key' value='_timestamp' label='added' icon='clock'
            +session_set key='sort_key' value='points' label='points' icon='hashtag'
            
            if skv_is 'group_sort_key' 'points'
                .ui.circular.black.icon.button.set_sort_points
                    i.large.thumbs.up.icon
            else
                .ui.circular.basic.icon.button.set_sort_points
                    i.large.thumbs.up.icon
            if skv_is 'group_sort_key' '_timestamp'
                .ui.circular.black.icon.button.set_sort_timestamp
                    i.clock.large.icon
            else
                .ui.circular.basic.icon.button.set_sort_timestamp
                    i.clock.large.icon
            if skv_is 'group_sort_key' 'views'
                .ui.circular.black.icon.button.set_sort_views
                    i.eye.large.icon
            else
                .ui.circular.basic.icon.button.set_sort_views
                    i.eye.large.icon
            .scrolling    
                .ui.hidden.divider
                if subs_ready
                    if one_result
                        .ui.one.cards
                            each group_docs
                                +group_card_med
                    else if two_results
                        .ui.two.cards
                            each group_docs
                                +group_card_med
                    else 
                        .ui.stackable.three.cards
                            if group_docs.count
                                each group_docs
                                    +group_card
                else
                    i.massive.grey.loading.yin.yang.icon

template(name='search_input')
    .ui.left.icon.search.input
        if current_query
            i.remove.red.circular.link.icon.zoomer.clear_search
        else 
            i.search.icon
        input.search.prompt(type='text' autocomplete="off" placeholder='tags')




template(name='group_card')
    .ui.card.zoomer
        if image_id
            a.image.zoomer.fly_right(href="/group/#{_id}")
                img.ui.image(src="{{c.url image_id width=600 height=600}}")
        .content
            a.ui.header.zoomer.fly_right(href="/group/#{_id}")
                |#{title}
            |#{member_ids.length} members
            .smallscroll
                |!{description}
            //+ismall name='tags' cl='ui inline image'
            each seven_tags
                .ui.label #{this}
            a.zoomer(href="/group/#{_id}")
                i.chevron.right.large.circular.icon
            // if is_admin
            //     .ui.small.header slug: #{slug}
            if can_edit
                a.ui.circular.icon.button(href="/group/#{_id}/edit")
                    i.pencil.blue.icon
            +print_this
                    
template(name='group_item')
    a.item.zoomer(href="/group/#{_id}")
        if image_id
            img.ui.tiny.image(src="{{c.url image_id width=300 height=300}}")
        //     a.image.zoomer.fly_right(href="/group/#{_id}")
        .middle.aligned.content
            a.ui.header.zoomer.fly_right(href="/group/#{_id}")
                |#{title}
            |#{member_ids.length} members
            // .smallscroll
            //     |!{description}
            //+ismall name='tags' cl='ui inline image'
        .middle.aligned.content
            each seven_tags
                .ui.label #{this}
            if location 
                i.red.marker.icon 
                |#{location}
            // a.zoomer(href="/group/#{_id}")
            //     i.chevron.right.large.circular.icon
            // if is_admin
            //     .ui.small.header slug: #{slug}
            // if can_edit
            //     a.ui.circular.icon.button(href="/group/#{_id}/edit")
            //         i.pencil.blue.icon
            +print_this
                    


template(name='group_info')
    with group_doc
        .ui.large.image.label(title='group') 
            +i name='campfire'
            img.ui.image(src="{{c.url image_id width=200 height=200}}")
            |#{title}


template(name='group_edit')
    with current_doc
        .ui.stackable.padded.grid
            .three.column.row
                .column
                    .ui.header 
                        i.pencil.icon
                        |edit group
                    a.ui.big.icon.fluid.green.button.fly_up(href="/group/#{_id}" title='save')
                        i.checkmark.large.icon
                    +remove_button
                    +image_edit key='image_id' label='image' direct=true
                .column 
                    +text_edit key='title' direct=true
                    +html_edit key='description' label='content' icon='content' direct=true
                    +call_watson key='description'
                .column
                    // +single_user_edit key='leader_id' label='leader' icon='crown' direct=true
                    +multi_user_edit key='leader_ids' label='leaders' icon='crown' direct=true
                    +array_edit key='tags' label='tags' icon='tags' direct=true
                    +array_edit key='location_tags' label='location tags' icon='marker' direct=true
                    +text_edit key='contact_info' label='contact info' icon='info' direct=true
                    +multi_user_edit key='member_ids' label='members' direct=true
                    +boolean_edit key='private' label='private' direct=true
                    +link_edit key='link' label='link' direct=true
                .column
                    .ui.header 
                        i.cubes.icon
                        |modules
                    +boolean_edit key='has_checkin' label='checkin' icon='clock' direct=true
                    +boolean_edit key='has_shop' label='shop' icon='shop' direct=true
                    +boolean_edit key='has_posts' label='posts' icon='blog' direct=true
                    +boolean_edit key='has_tasks' label='tasks' icon='tasks' direct=true
                    
                    
template(name='group_layout')
    +nav
    .ui.bottom.attached.pushable.segment.scrolling
        +topbar
        +leftbar
        +rightbar
        .global_container.bg
            with current_doc
                .ui.stackable.padded.grid
                    .row
                        .four.wide.column
                            +group_sidebar
                        .twelve.wide.column
                            a.ui.circular.compact.button(href="/group/#{current_doc._id}/")
                                +i name='dashboard'
                                |dashboard
                            +group_nav_item key='posts' icon='blog'
                            +group_nav_item key='events' icon='calendar'
                            +group_nav_item key='members' icon='groups'
                            +group_nav_item key='chat' icon='chat'
                            .scrolling
                                +yield

template(name='group_sidebar')
    .ui.inline.header 
        if icon
            +i name=icon
        |#{title}
    a.ui.circular.button.fly_right(href="/groups")
        i.left.chevron.icon
        // i.big.fire.icon
        +i name='campfire' cl='ui mini inline image'
        |groups
    if can_edit
        a.ui.circular.icon.button.fly_down(href="/group/#{_id}/edit")
            i.setting.large.icon
    +image_view key='image_id' icon='image' label='image'
    +array_view key='tags' icon='tags'
    .spacer
    if link
        a.ui.circular.button(href=link target='_window')
            i.external.icon
            |#{link}
        .spacer
    div
    if address
        a.ui.compact.circular.button(href=address_link target='_window')
            i.marker.icon
            |#{address}
    +viewing
    if in_dev 
        +print_this
    +multi_user_view key='member_ids' label='members' direct=true


template(name='group_nav_item')
    a.ui.circular.compact.button(href="/group/#{current_doc._id}/#{key}")
        +i name=icon
        |#{key}
                
                
template(name='group_posts')                
    .four.wide.column
        .ui.header 
            +i name='blog'
            |group posts
    if currentUser 
        .ui.icon.button.add_group_post(title='add group post')
            i.plus.icon
    .twelve.wide.column
        .ui.stackable.doubling.centered.cards
            each group_post_docs 
                +post_card
        .ui.large.link.animated.list
            each group_posts
                a.item(href="/post/#{_id}")
                    img.ui.avatar.image(src="{{c.url image_id width=200 height=200}}")
                    |#{title}


template(name='group_chat')    
    .ui.header 
        +i name='chat'
        |group chat
    +comments
    
                    
                    
                    
template(name='group_view')
    .ui.stackable.padded.grid
        .row
            .ten.wide.column
                +group_about
                +group_members
                // .ui.large.selection.animated.list
                        // a.item(href="/group/#{_id}/#{username}")
                        //     img.ui.mini.image(src="{{c.url image_id width=200 height=200}}")
                        //     .content
                        //         .header
                        //             |#{username}
                if currentUser
                    +doc_array_togggle key='member_ids' value=currentUser._id add_label='join' remove_label='leave'
                else 
                    a.ui.big.button(href="/login")
                        +i name='internal'
                        |join
            .six.wide.column
                +group_activity
                    +comments
            .eight.wide.column
                +group_events
                +group_posts
                if has_shop
                    .four.wide.column
                        +group_shop
                if has_tasks 
                    +group_tasks
               
template(name='group_members')
    .ui.header
        +i name='groups'
        |people
    .ui.button.add_user_member
        |add member
    if leaders_id
        .ui.inline.header 
            +i name='crown' cl='ui avatar image'
            // i.crown.icon
            |leaders: 
        each leader_ids 
            +user_info
    div
    .ui.inline.header 
        +i name='groups'
        // i.users.icon
        |#{member_ids.length} members
    each member_ids
        +user_info

               
               
template(name='group_about')
    .ui.inline.header
        i.info.icon
        |about
    +html_view key='description' icon='content' label='description'
    if watson 
        +watson_view

                                            
               
template(name='group_activity')
    .ui.header
        +i name='rss'
        |activity
    .content
        each log_items
            +log_item
        .ui.header 
            +i name='line-chart'
            // i.large.line.chart.icon
            |stats
        i.refresh.link.icon.refresh_group_stats
        .ui.large.list
            .item #{member_count} members
            .item #{events} events
            .item #{total_credit_exchanged} credits exchanged

              
              
template(name='group_events')              
    .ui.header
        .ui.inline.header
            +i name='calendar' 
            // i.calendar.large.icon
            |group events
    .content
        if currentUser 
            .ui.icon.button.add_group_event(title='add group event')
                i.plus.icon
        .ui.link.animated.list
            each group_events
                a.item(href="/event/#{_id}") 
                    img.ui.avatar.image(src="{{c.url image_id width=200 height=200}}")
                    .content
                        .header #{title}
                        .description
                            if is_repeating
                                i.refresh.icon
                                |every #{repeating_day}
                            if start_datetime
                                |{{from_now start_datetime}}
              
               
template(name='group_tasks')
    .ui.header
        i.tasks.icon
        |tasks
    if currentUser
        i.large.circular.link.plus.icon.add_group_task
    .ui.large.list 
        each group_tasks 
            a.item(href="/tasks/#{_id}")
                |#{title}

                                
             

                                
                                
template(name='group_shop')
    .ui.header 
        +i name='shop'
        |shop
    if currentUser
        .ui.button.add_product  
            i.plus.icon
    each group_products 
        a.item(href="/post/#{_id}")
            img.ui.avatar.image(src="{{c.url image_id width=200 height=200}}")
            |#{title}
                                                        
    
    
    
template(name='groups_small')
    a.ui.header.zoomer(href="/groups")
        +i name='groups'
        |groups
    .ui.selection.animated.list.smallscroll
        each group_docs
            a.item(href="/group/#{_id}")
                img.ui.avatar.image(src="{{c.url image_id width=200 height=200}}")
                |#{title}